import{d as P,E as H,e as j,a as xe,y as w,x as T,C as R,I as g,u as e,A as o,z as m,r as I,b as A,o as _e,X as Le,B as ie,n as Qe,G as M,Y as ve,H as O,L as G,D as k,S as oe,F as le,K as se,V as Z,W as ee,U as Pe,M as je}from"./vue-vendor-DSdsonjH.js";import{c as De,g as He,e as me,b as Fe,f as ye,h as fe,u as Ge,C as Ke}from"./index-BjQVUTM4.js";import{_ as We}from"./FolderPicker.vue_vue_type_script_setup_true_lang-CzuK4Ble.js";import{u as Ye,i as Xe,a as Je,b as Ze,E as et}from"./tiptap-D4bq3STi.js";import{d as tt,I as ot,U as nt,e as lt,L as st,f as at,Q as it,h as dt,i as rt,j as ut,R as ct,k as be,l as ge,F as he,G as de,m as ke,n as $e,P as we,T as re,o as pt,p as Ee,q as ne,r as Se,V as Ce,X as Ie,Y as Ve,s as vt,t as mt,x as yt,u as ft,y as ae}from"./ui-BLgiSNLv.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as ce}from"./vue-draggable-next.esm-bundler-DB3MgKZV.js";const bt={key:0,class:"flex flex-wrap items-center gap-1 p-2 border-b border-gray-200 bg-gray-50 rounded-t-md"},gt=["title"],ht=["title"],xt=["title"],_t=["title"],kt=["title"],$t=["title"],wt=["title"],Et=["title"],St=["title"],Ct=["title"],It=["title"],Vt=["title"],Tt=["title","disabled"],qt=["title","disabled"],Ot=P({__name:"RichTextEditor",props:{modelValue:{},placeholder:{},readonly:{type:Boolean}},emits:["update:modelValue"],setup(h,{emit:x}){const l=h,n=x,{t:s}=H(),t=Ye({extensions:[Xe.configure({heading:{levels:[1,2,3]},link:!1,underline:!1}),Je,Ze.configure({openOnClick:!1,HTMLAttributes:{class:"text-blue-600 underline"}})],content:l.modelValue,editable:!l.readonly,onUpdate:({editor:p})=>{l.readonly||n("update:modelValue",p.getHTML())},editorProps:{attributes:{class:"rich-text-content px-3 py-2 border-0 focus:outline-none focus:ring-0","data-placeholder":l.placeholder||""}}}),u=()=>{if(!t.value)return;const p=t.value.getAttributes("link").href,a=window.prompt(s("richTextEditor.link"),p);if(a!==null){if(a===""){t.value.chain().focus().extendMarkRange("link").unsetLink().run();return}t.value.chain().focus().extendMarkRange("link").setLink({href:a}).run()}};return j(()=>l.modelValue,p=>{t.value?.getHTML()!==p&&t.value?.commands.setContent(p)}),j(()=>l.readonly,p=>{t.value&&t.value.setEditable(!p)},{immediate:!0}),xe(()=>{t.value?.destroy()}),(p,a)=>(m(),w("div",{class:T(["rich-text-editor",{"readonly-mode":l.readonly}])},[e(t)&&!l.readonly?(m(),w("div",bt,[o("button",{type:"button",class:T(["p-1.5 rounded hover:bg-gray-200 transition-colors",e(t).isActive("bold")?"bg-gray-300":""]),title:e(s)("richTextEditor.bold"),onClick:a[0]||(a[0]=b=>e(t).chain().focus().toggleBold().run())},[g(e(tt),{size:16,class:"text-gray-700"})],10,gt),o("button",{type:"button",class:T(["p-1.5 rounded hover:bg-gray-200 transition-colors",e(t).isActive("italic")?"bg-gray-300":""]),title:e(s)("richTextEditor.italic"),onClick:a[1]||(a[1]=b=>e(t).chain().focus().toggleItalic().run())},[g(e(ot),{size:16,class:"text-gray-700"})],10,ht),o("button",{type:"button",class:T(["p-1.5 rounded hover:bg-gray-200 transition-colors",e(t).isActive("underline")?"bg-gray-300":""]),title:e(s)("richTextEditor.underline"),onClick:a[2]||(a[2]=b=>e(t).chain().focus().toggleUnderline().run())},[g(e(nt),{size:16,class:"text-gray-700"})],10,xt),o("button",{type:"button",class:T(["p-1.5 rounded hover:bg-gray-200 transition-colors",e(t).isActive("strike")?"bg-gray-300":""]),title:e(s)("richTextEditor.strike"),onClick:a[3]||(a[3]=b=>e(t).chain().focus().toggleStrike().run())},[g(e(lt),{size:16,class:"text-gray-700"})],10,_t),a[13]||(a[13]=o("div",{class:"w-px h-6 bg-gray-300 mx-1"},null,-1)),o("button",{type:"button",class:T(["px-2 py-1 rounded text-sm hover:bg-gray-200 transition-colors",e(t).isActive("heading",{level:1})?"bg-gray-300 font-semibold":""]),title:e(s)("richTextEditor.heading1"),onClick:a[4]||(a[4]=b=>e(t).chain().focus().toggleHeading({level:1}).run())}," H1 ",10,kt),o("button",{type:"button",class:T(["px-2 py-1 rounded text-sm hover:bg-gray-200 transition-colors",e(t).isActive("heading",{level:2})?"bg-gray-300 font-semibold":""]),title:e(s)("richTextEditor.heading2"),onClick:a[5]||(a[5]=b=>e(t).chain().focus().toggleHeading({level:2}).run())}," H2 ",10,$t),o("button",{type:"button",class:T(["px-2 py-1 rounded text-sm hover:bg-gray-200 transition-colors",e(t).isActive("heading",{level:3})?"bg-gray-300 font-semibold":""]),title:e(s)("richTextEditor.heading3"),onClick:a[6]||(a[6]=b=>e(t).chain().focus().toggleHeading({level:3}).run())}," H3 ",10,wt),a[14]||(a[14]=o("div",{class:"w-px h-6 bg-gray-300 mx-1"},null,-1)),o("button",{type:"button",class:T(["p-1.5 rounded hover:bg-gray-200 transition-colors",e(t).isActive("bulletList")?"bg-gray-300":""]),title:e(s)("richTextEditor.bulletList"),onClick:a[7]||(a[7]=b=>e(t).chain().focus().toggleBulletList().run())},[g(e(st),{size:16,class:"text-gray-700"})],10,Et),o("button",{type:"button",class:T(["p-1.5 rounded hover:bg-gray-200 transition-colors",e(t).isActive("orderedList")?"bg-gray-300":""]),title:e(s)("richTextEditor.orderedList"),onClick:a[8]||(a[8]=b=>e(t).chain().focus().toggleOrderedList().run())},[g(e(at),{size:16,class:"text-gray-700"})],10,St),a[15]||(a[15]=o("div",{class:"w-px h-6 bg-gray-300 mx-1"},null,-1)),o("button",{type:"button",class:T(["p-1.5 rounded hover:bg-gray-200 transition-colors",e(t).isActive("blockquote")?"bg-gray-300":""]),title:e(s)("richTextEditor.blockquote"),onClick:a[9]||(a[9]=b=>e(t).chain().focus().toggleBlockquote().run())},[g(e(it),{size:16,class:"text-gray-700"})],10,Ct),o("button",{type:"button",class:T(["p-1.5 rounded hover:bg-gray-200 transition-colors",e(t).isActive("codeBlock")?"bg-gray-300":""]),title:e(s)("richTextEditor.codeBlock"),onClick:a[10]||(a[10]=b=>e(t).chain().focus().toggleCodeBlock().run())},[g(e(dt),{size:16,class:"text-gray-700"})],10,It),a[16]||(a[16]=o("div",{class:"w-px h-6 bg-gray-300 mx-1"},null,-1)),o("button",{type:"button",class:T(["p-1.5 rounded hover:bg-gray-200 transition-colors",e(t).isActive("link")?"bg-gray-300":""]),title:e(t).isActive("link")?e(s)("richTextEditor.unlink"):e(s)("richTextEditor.link"),onClick:u},[g(e(rt),{size:16,class:"text-gray-700"})],10,Vt),a[17]||(a[17]=o("div",{class:"w-px h-6 bg-gray-300 mx-1"},null,-1)),o("button",{type:"button",class:"p-1.5 rounded hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:e(s)("richTextEditor.undo"),disabled:!e(t).can().undo(),onClick:a[11]||(a[11]=b=>e(t).chain().focus().undo().run())},[g(e(ut),{size:16,class:"text-gray-700"})],8,Tt),o("button",{type:"button",class:"p-1.5 rounded hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:e(s)("richTextEditor.redo"),disabled:!e(t).can().redo(),onClick:a[12]||(a[12]=b=>e(t).chain().focus().redo().run())},[g(e(ct),{size:16,class:"text-gray-700"})],8,qt)])):R("",!0),g(e(et),{editor:e(t),class:"rich-text-content-wrapper"},null,8,["editor"])],2))}}),pe=ue(Ot,[["__scopeId","data-v-09e099cc"]]),Rt=P({__name:"Collapsible",props:{value:{type:Boolean,default:!0},duration:{default:200},transition:{default:"linear"}},setup(h){const x=h,l=I(null),n=I(x.value?"0":"unset"),s=I(x.value?"hidden":"unset"),t=A(()=>({transition:`max-height ${x.transition} ${x.duration}ms`,maxHeight:n.value,overflow:s.value})),u=p=>{l.value&&p.target===l.value&&(x.value||(n.value="unset",s.value="unset"))};return _e(()=>{l.value&&l.value.addEventListener("transitionend",u)}),xe(()=>{l.value&&l.value.removeEventListener("transitionend",u)}),j(()=>x.value,(p,a)=>{a!==p&&l.value&&(n.value==="unset"&&(n.value=`${l.value.scrollHeight}px`,s.value="hidden"),Qe(()=>{setTimeout(()=>{l.value&&(n.value=p?"0":`${l.value.scrollHeight}px`)},0)}))}),(p,a)=>(m(),w("div",{style:Le(t.value),ref_key:"rootEl",ref:l},[ie(p.$slots,"default")],4))}}),At=["aria-expanded"],zt=P({__name:"Accordion",props:{label:{default:""},open:{type:Boolean,default:!1},duration:{default:200},transition:{default:"linear"},caretPosition:{default:"right"},indicatorType:{default:"chevron"},headerHover:{type:Boolean,default:!1},headerGroup:{type:Boolean,default:!1}},emits:["update:open","toggle"],setup(h,{emit:x}){const l=h,n=x,s=I(l.open);j(()=>l.open,_=>{s.value=_});const t=()=>{const _=!s.value;s.value=_,n("update:open",_),n("toggle",_)},u=A(()=>l.duration),p=A(()=>l.transition),a=A(()=>l.label),b=A(()=>l.caretPosition);return(_,E)=>(m(),w("div",null,[o("button",{type:"button",class:T(["flex w-full items-center justify-between gap-2 py-2",b.value==="left"?"pl-2":"",l.headerHover?"hover:bg-gray-50":"",l.headerGroup?"group":""]),"aria-expanded":s.value,onClick:t},[o("div",{class:T(["min-w-0 flex-1 text-left",b.value==="left"?"flex items-center gap-2":""])},[b.value==="left"&&h.indicatorType==="chevron"?(m(),M(e(be),{key:0,class:T(["shrink-0 transition-transform",s.value?"rotate-90":"rotate-0"]),size:18,"aria-hidden":"true"},null,8,["class"])):b.value==="left"&&h.indicatorType==="folder"?(m(),M(ve(s.value?e(ge):e(he)),{key:1,class:"shrink-0 transition-all",size:18,"aria-hidden":"true"})):R("",!0),ie(_.$slots,"header",{},()=>[G(k(a.value),1)])],2),b.value==="right"&&h.indicatorType==="chevron"?(m(),M(e(be),{key:0,class:T(["shrink-0 transition-transform",s.value?"rotate-90":"rotate-0"]),size:18,"aria-hidden":"true"},null,8,["class"])):b.value==="right"&&h.indicatorType==="folder"?(m(),M(ve(s.value?e(ge):e(he)),{key:1,class:"shrink-0 transition-all",size:18,"aria-hidden":"true"})):R("",!0)],10,At),g(Rt,{value:!s.value,duration:u.value,transition:p.value},{default:O(()=>[ie(_.$slots,"default")]),_:3},8,["value","duration","transition"])]))}}),Nt={class:"flex items-center justify-between px-2 py-1 text-sm rounded transition hover:bg-gray-50 group"},Bt={class:"inline-flex items-center gap-2 flex-1 min-w-0"},Mt=["title"],Ut={class:"truncate"},Lt={key:0,class:"inline-flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity shrink-0"},Qt=["aria-label"],Pt=["aria-label"],jt=P({__name:"StepListItem",props:{step:{},index:{},readonly:{type:Boolean}},emits:["edit","delete"],setup(h,{emit:x}){const{t:l}=H(),n=x,s=()=>{n("edit")},t=()=>{n("delete")};return(u,p)=>(m(),w("div",Nt,[o("span",Bt,[h.readonly?R("",!0):(m(),w("button",{key:0,type:"button",class:"drag-handle shrink-0 opacity-0 group-hover:opacity-100 transition-opacity text-gray-400 hover:text-gray-600 cursor-move",title:e(l)("common.drag")},[g(e(de),{size:16})],8,Mt)),h.step.type==="slide"?(m(),M(e(ke),{key:1,size:16,class:"text-gray-500 shrink-0","aria-hidden":"true"})):(m(),M(e($e),{key:2,size:16,class:"text-gray-500 shrink-0","aria-hidden":"true"})),o("span",Ut,k(h.step.name||e(l)("stepList.unnamedStep")),1)]),h.readonly?R("",!0):(m(),w("span",Lt,[o("button",{type:"button",class:"rounded p-1 hover:bg-gray-100","aria-label":e(l)("common.edit"),onClick:oe(s,["stop"])},[g(e(we),{size:14,class:"text-gray-500","aria-hidden":"true"})],8,Qt),o("button",{type:"button",class:"rounded p-1 hover:bg-gray-100","aria-label":e(l)("common.delete"),onClick:oe(t,["stop"])},[g(e(re),{size:14,class:"text-gray-500","aria-hidden":"true"})],8,Pt)]))]))}}),Dt={class:"space-y-2"},Ht={key:0,class:"text-center py-8 text-gray-500 text-sm"},Ft={key:2,class:"flex gap-2 pt-2"},Gt=P({__name:"StepList",props:{steps:{},sectionId:{},editable:{type:Boolean,default:!0},readonly:{type:Boolean,default:!1}},emits:["add-slide","add-question","edit-slide","edit-question","delete-step","reorder-steps"],setup(h,{emit:x}){const{t:l}=H(),n=h,s=x,t=I([]);j(()=>n.steps,E=>{t.value=[...E]},{immediate:!0});const u=E=>{if(!E.moved){t.value=[...n.steps];return}const V=t.value.map($=>$.id);s("reorder-steps",{newOrder:V}),t.value=[...n.steps]},p=()=>{s("add-slide")},a=()=>{s("add-question")},b=E=>{E.type==="slide"?s("edit-slide",{stepId:E.id}):s("edit-question",{stepId:E.id})},_=E=>{s("delete-step",{stepId:E.id})};return(E,V)=>(m(),w("div",Dt,[h.steps.length===0?(m(),w("div",Ht,k(e(l)("stepList.noSteps")),1)):(m(),M(e(ce),{key:1,modelValue:t.value,"onUpdate:modelValue":V[0]||(V[0]=$=>t.value=$),"item-key":"id",tag:"div",class:"space-y-1",animation:200,disabled:h.readonly,handle:".drag-handle",onChange:u},{default:O(()=>[(m(!0),w(le,null,se(t.value,($,q)=>(m(),M(jt,{key:$.id,step:$,index:q,readonly:h.readonly,onEdit:N=>b($),onDelete:N=>_($)},null,8,["step","index","readonly","onEdit","onDelete"]))),128))]),_:1},8,["modelValue","disabled"])),h.editable&&!h.readonly?(m(),w("div",Ft,[o("button",{type:"button",class:"flex-1 px-3 py-2 text-sm text-gray-600 border border-gray-300 border-dashed rounded-md hover:bg-gray-50 hover:border-gray-400 transition-colors inline-flex items-center justify-center gap-2",onClick:p},[g(e(ke),{size:16,class:"text-gray-500"}),o("span",null,k(e(l)("stepList.addSlide")),1)]),o("button",{type:"button",class:"flex-1 px-3 py-2 text-sm text-gray-600 border border-gray-300 border-dashed rounded-md hover:bg-gray-50 hover:border-gray-400 transition-colors inline-flex items-center justify-center gap-2",onClick:a},[g(e($e),{size:16,class:"text-gray-500"}),o("span",null,k(e(l)("stepList.addQuestion")),1)])])):R("",!0)]))}}),Kt=ue(Gt,[["__scopeId","data-v-a4dc60af"]]),Wt={class:"border border-gray-200 rounded-md"},Yt={class:"flex items-center justify-between w-full pr-2"},Xt={class:"flex items-center gap-3 flex-1 min-w-0"},Jt=["title"],Zt={class:"font-medium text-gray-900 truncate"},eo={class:"text-xs font-semibold text-white bg-blue-600 px-2 py-0.5 rounded-full shrink-0"},to={key:0,class:"inline-flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity shrink-0"},oo=["aria-label"],no=["aria-label"],lo={class:"px-4 pb-4 pt-2"},so=P({__name:"SectionAccordion",props:{section:{},sectionIndex:{},readonly:{type:Boolean}},emits:["edit-name","delete","update:section","add-slide","add-question","edit-slide","edit-question","delete-step","reorder-steps"],setup(h,{emit:x}){const{t:l}=H(),n=h,s=x,t=I(!1),u=()=>{s("edit-name")},p=()=>{s("delete")},a=()=>{s("add-slide")},b=()=>{s("add-question")},_=q=>{s("edit-slide",q)},E=q=>{s("edit-question",q)},V=q=>{s("delete-step",q)},$=q=>{const N=new Map(n.section.steps.map(d=>[d.id,d])),U=q.newOrder.map(d=>N.get(d)).filter(Boolean),i={...n.section,steps:U};s("update:section",i)};return(q,N)=>(m(),w("div",Wt,[g(zt,{open:t.value,"onUpdate:open":N[0]||(N[0]=U=>t.value=U),"caret-position":"left","header-hover":!0,"header-group":""},{header:O(()=>[o("div",Yt,[o("div",Xt,[h.readonly?R("",!0):(m(),w("button",{key:0,type:"button",class:"drag-handle shrink-0 opacity-0 group-hover:opacity-100 transition-opacity text-gray-400 hover:text-gray-600 cursor-move",title:e(l)("common.drag")},[g(e(de),{size:16})],8,Jt)),o("span",Zt,k(h.section.name),1),o("span",eo,k(h.section.steps.length),1)]),h.readonly?R("",!0):(m(),w("div",to,[o("button",{type:"button",class:"rounded p-1 hover:bg-gray-100","aria-label":e(l)("common.edit"),onClick:oe(u,["stop"])},[g(e(we),{size:14,class:"text-gray-500","aria-hidden":"true"})],8,oo),o("button",{type:"button",class:"rounded p-1 hover:bg-gray-100","aria-label":e(l)("common.delete"),onClick:oe(p,["stop"])},[g(e(re),{size:14,class:"text-gray-500","aria-hidden":"true"})],8,no)]))])]),default:O(()=>[o("div",lo,[g(Kt,{steps:h.section.steps,"section-id":h.section.id,readonly:h.readonly,onAddSlide:a,onAddQuestion:b,onEditSlide:_,onEditQuestion:E,onDeleteStep:V,onReorderSteps:$},null,8,["steps","section-id","readonly"])])]),_:1},8,["open"])]))}}),ao={class:"space-y-2"},io={key:0,class:"text-center py-8 text-gray-500 text-sm"},ro=P({__name:"CourseStructureView",props:{structure:{},readonly:{type:Boolean}},emits:["update:structure","add-section","edit-section-name","delete-section","add-slide","add-question","edit-slide","edit-question","delete-step"],setup(h,{emit:x}){const{t:l}=H(),n=h,s=x,t=I([]);j(()=>n.structure,i=>{t.value=[...i]},{immediate:!0});const u=()=>{s("update:structure",[...t.value]),t.value=[...n.structure]},p=()=>{s("add-section")},a=i=>{s("edit-section-name",{sectionId:i.id})},b=i=>{s("delete-section",{sectionId:i.id})},_=i=>{s("add-slide",{sectionId:i.id})},E=i=>{s("add-question",{sectionId:i.id})},V=(i,d)=>{s("edit-slide",{sectionId:i.id,stepId:d.stepId})},$=(i,d)=>{s("edit-question",{sectionId:i.id,stepId:d.stepId})},q=(i,d)=>{s("delete-step",{sectionId:i.id,stepId:d.stepId})},N=(i,d)=>{const c=new Map(i.steps.map(B=>[B.id,B])),f=d.newOrder.map(B=>c.get(B)).filter(Boolean),S={...i,steps:f},F=t.value.map(B=>B.id===i.id?S:B);t.value=F,s("update:structure",F)},U=i=>{const d=t.value.map(c=>c.id===i.id?i:c);t.value=d,s("update:structure",d)};return(i,d)=>(m(),w("div",ao,[t.value.length===0?(m(),w("div",io,k(e(l)("courseStructureView.noSections")),1)):(m(),M(e(ce),{key:1,modelValue:t.value,"onUpdate:modelValue":d[0]||(d[0]=c=>t.value=c),"item-key":"id",tag:"div",class:"space-y-2",animation:200,disabled:h.readonly,handle:".drag-handle",onChange:u},{default:O(()=>[(m(!0),w(le,null,se(t.value,(c,f)=>(m(),M(so,{key:c.id,section:c,"section-index":f,readonly:h.readonly,onEditName:S=>a(c),onDelete:S=>b(c),onAddSlide:S=>_(c),onAddQuestion:S=>E(c),onEditSlide:S=>V(c,S),onEditQuestion:S=>$(c,S),onDeleteStep:S=>q(c,S),onReorderSteps:S=>N(c,S),"onUpdate:section":U},null,8,["section","section-index","readonly","onEditName","onDelete","onAddSlide","onAddQuestion","onEditSlide","onEditQuestion","onDeleteStep","onReorderSteps"]))),128))]),_:1},8,["modelValue","disabled"])),h.readonly?R("",!0):(m(),w("button",{key:2,type:"button",class:"w-full px-3 py-2 text-sm text-gray-600 border border-gray-300 border-dashed rounded-md hover:bg-gray-50 hover:border-gray-400 transition-colors inline-flex items-center justify-center gap-2",onClick:p},[g(e(pt),{size:16,class:"text-gray-500"}),o("span",null,k(e(l)("courseStructureView.addSection")),1)]))]))}}),uo=ue(ro,[["__scopeId","data-v-08de7304"]]),co={class:"fixed inset-0 flex items-center justify-center p-4"},po={class:"flex items-center justify-between p-6 border-b"},vo={class:"p-6"},mo={class:"block text-sm font-medium text-gray-700 mb-1"},yo=["placeholder"],fo={key:0,class:"mt-1 text-xs text-red-500"},bo={class:"flex items-center justify-end gap-3 p-6 border-t bg-gray-50"},go=["disabled"],ho=P({__name:"SectionEditorModal",props:{section:{},open:{type:Boolean}},emits:["update:open","save"],setup(h,{emit:x}){const{t:l}=H(),n=h,s=x,t=I(""),u=I(null),p=A(()=>n.section===null),a=A(()=>t.value.trim().length>0);j(()=>n.open,V=>{V&&(t.value=n.section?.name||"",u.value=null)});const b=()=>{t.value.trim()?u.value=null:u.value=l("sectionEditorModal.validation.nameRequired")},_=()=>{s("update:open",!1)},E=()=>{if(!a.value){b();return}const V=n.section?{...n.section,name:t.value.trim()}:{id:`section-${Math.random().toString(36).substr(2,9)}`,name:t.value.trim(),steps:[]};s("save",V),s("update:open",!1)};return(V,$)=>(m(),M(e(Ee),{show:h.open,as:"template"},{default:O(()=>[g(e(Ve),{open:h.open,onClose:_,class:"relative z-50"},{default:O(()=>[g(e(ne),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:O(()=>[...$[1]||($[1]=[o("div",{class:"fixed inset-0 bg-black/30"},null,-1)])]),_:1}),o("div",co,[g(e(ne),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:O(()=>[g(e(Se),{class:"w-full max-w-md bg-white rounded-lg shadow-xl"},{default:O(()=>[o("div",po,[g(e(Ce),{class:"text-lg font-semibold"},{default:O(()=>[G(k(p.value?e(l)("sectionEditorModal.createTitle"):e(l)("sectionEditorModal.editTitle")),1)]),_:1}),o("button",{type:"button",class:"rounded p-1 hover:bg-gray-100",onClick:_},[g(e(Ie),{size:20,class:"text-gray-500"})])]),o("div",vo,[o("div",null,[o("label",mo,[G(k(e(l)("sectionEditorModal.nameLabel"))+" ",1),$[2]||($[2]=o("span",{class:"text-red-500"},"*",-1))]),Z(o("input",{"onUpdate:modelValue":$[0]||($[0]=q=>t.value=q),type:"text",class:T(["w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2",u.value?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-blue-500"]),placeholder:e(l)("sectionEditorModal.namePlaceholder"),onInput:b},null,42,yo),[[ee,t.value]]),u.value?(m(),w("p",fo,k(u.value),1)):R("",!0)])]),o("div",bo,[o("button",{type:"button",class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",onClick:_},k(e(l)("common.cancel")),1),o("button",{type:"button",class:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!a.value,onClick:E},k(e(l)("common.save")),9,go)])]),_:1})]),_:1})])]),_:1},8,["open"])]),_:1},8,["show"]))}}),xo={class:"flex flex-col h-full space-y-4 min-h-0"},_o={class:"flex-shrink-0"},ko={class:"block text-sm font-medium text-gray-700 mb-1"},$o=["value","readonly","disabled","placeholder"],wo={key:0,class:"mt-1 text-xs text-red-500"},Eo={class:"flex flex-col flex-1 min-h-0"},So={class:"block text-sm font-medium text-gray-700 mb-1 flex-shrink-0"},Co={key:0,class:"mt-1 text-xs text-red-500 flex-shrink-0"},Io=P({__name:"SlideEditor",props:{modelValue:{},readonly:{type:Boolean}},emits:["update:modelValue","update:valid"],setup(h,{emit:x}){const{t:l}=H(),n=h,s=x,t=A({get(){return n.modelValue},set(_){s("update:modelValue",_)}}),u=A(()=>{const _={};return t.value.name.trim()||(_.name=l("slideEditor.validation.nameRequired")),t.value.content.replace(/<[^>]*>/g,"").trim()||(_.content=l("slideEditor.validation.contentRequired")),_}),p=A(()=>Object.keys(u.value).length===0);j(()=>p.value,_=>{s("update:valid",_)},{immediate:!0});const a=_=>{t.value={...t.value,name:_}},b=_=>{t.value={...t.value,content:_}};return(_,E)=>(m(),w("div",xo,[o("div",_o,[o("label",ko,[G(k(e(l)("slideEditor.name"))+" ",1),E[1]||(E[1]=o("span",{class:"text-red-500"},"*",-1))]),(m(),w("input",{key:`slide-name-${n.modelValue.id}`,value:t.value.name,type:"text",readonly:n.readonly,disabled:n.readonly,class:T(["w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2",u.value.name?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-blue-500",n.readonly?"bg-gray-50 cursor-not-allowed":""]),placeholder:e(l)("slideEditor.namePlaceholder"),onInput:E[0]||(E[0]=V=>a(V.target.value))},null,42,$o)),u.value.name?(m(),w("p",wo,k(u.value.name),1)):R("",!0)]),o("div",Eo,[o("label",So,[G(k(e(l)("slideEditor.content"))+" ",1),E[2]||(E[2]=o("span",{class:"text-red-500"},"*",-1))]),o("div",{class:T(["border rounded-md flex flex-col flex-1 min-h-0",u.value.content?"border-red-500":"border-gray-300"])},[g(pe,{"model-value":t.value.content,placeholder:e(l)("slideEditor.contentPlaceholder"),readonly:n.readonly,"onUpdate:modelValue":b},null,8,["model-value","placeholder","readonly"])],2),u.value.content?(m(),w("p",Co,k(u.value.content),1)):R("",!0)])]))}}),Vo={class:"flex flex-col h-full space-y-4 min-h-0"},To={class:"shrink-0"},qo={class:"block text-sm font-medium text-gray-700 mb-1"},Oo=["value","readonly","disabled","placeholder"],Ro={key:0,class:"mt-1 text-xs text-red-500"},Ao={class:"flex flex-col flex-1 min-h-0"},zo={class:"block text-sm font-medium text-gray-700 mb-1 shrink-0"},No={class:"flex flex-col flex-1 min-h-0 border rounded-md border-gray-300"},Bo={class:"shrink-0"},Mo={class:"block text-sm font-medium text-gray-700 mb-2"},Uo={class:"flex gap-4"},Lo=["checked","disabled"],Qo={class:"text-sm text-gray-700"},Po=["checked","disabled"],jo={class:"text-sm text-gray-700"},Do={class:"shrink-0"},Ho={class:"block text-sm font-medium text-gray-700 mb-2"},Fo=["title"],Go={class:"shrink-0 flex items-center"},Ko=["checked","disabled","name","onChange"],Wo=["checked","disabled","onChange"],Yo={class:"flex-1 flex items-center"},Xo=["onUpdate:modelValue","readonly","disabled","placeholder","onInput"],Jo={key:1,class:"absolute -bottom-5 left-0 right-0"},Zo={class:"text-xs text-red-500"},en=["disabled","title","onClick"],tn={key:1,class:"text-xs text-red-500"},on=P({__name:"QuestionEditor",props:{modelValue:{},readonly:{type:Boolean}},emits:["update:modelValue","update:valid"],setup(h,{emit:x}){const{t:l}=H(),n=h,s=x,t=A({get(){return n.modelValue},set(i){s("update:modelValue",i)}}),u=I([]);j(()=>n.modelValue.options,i=>{u.value=i.map((d,c)=>({id:c,text:d}))},{immediate:!0});const p=A(()=>{const i={};t.value.name.trim()||(i.name=l("questionEditor.validation.nameRequired")),t.value.options.length<2&&(i.options=l("questionEditor.validation.minOptionsRequired"));const d={};return t.value.options.forEach((c,f)=>{c.trim()||(d[f]=l("questionEditor.validation.optionRequired"))}),Object.keys(d).length>0&&(i.optionTexts=d),i}),a=A(()=>Object.keys(p.value).length===0);j(()=>a.value,i=>{s("update:valid",i)},{immediate:!0});const b=i=>{if(!i.moved){u.value=n.modelValue.options.map((z,Q)=>({id:Q,text:z}));return}const{oldIndex:d,newIndex:c}=i.moved,f=[...n.modelValue.options],S=f[d];if(S===void 0)return;f.splice(d,1),f.splice(c,0,S);const F=new Map;n.modelValue.options.forEach((z,Q)=>{const te=f.indexOf(z);te!==-1&&F.set(Q,te)});const B=n.modelValue.inputRule.correctOptions.map(z=>F.get(z)).filter(z=>typeof z=="number").sort((z,Q)=>z-Q);t.value={...t.value,options:f,inputRule:{...t.value.inputRule,correctOptions:B}},u.value=f.map((z,Q)=>({id:Q,text:z}))},_=i=>{t.value={...t.value,name:i}},E=i=>{t.value={...t.value,slide:i}},V=i=>{const d=t.value.inputRule.correctOptions;let c=d;if(i==="single"){const f=d[0];c=f!==void 0?[f]:[]}t.value={...t.value,inputRule:{type:i,correctOptions:c}}},$=()=>{const i=[...t.value.options,""];t.value={...t.value,options:i},u.value=i.map((d,c)=>({id:c,text:d}))},q=i=>{const d=u.value[i];if(!d)return;const c=d.text,f=[...t.value.options];f[i]=c,t.value={...t.value,options:f}},N=i=>{if(t.value.options.length<=2)return;const d=t.value.options.filter((f,S)=>S!==i),c=t.value.inputRule.correctOptions.filter(f=>f!==i).map(f=>f>i?f-1:f).sort((f,S)=>f-S);t.value={...t.value,options:d,inputRule:{...t.value.inputRule,correctOptions:c}},u.value=d.map((f,S)=>({id:S,text:f}))},U=i=>{const d=t.value.inputRule.correctOptions,c=d.includes(i);let f;t.value.inputRule.type==="single"?f=c?[]:[i]:c?f=d.filter(S=>S!==i):f=[...d,i].sort((S,F)=>S-F),t.value={...t.value,inputRule:{...t.value.inputRule,correctOptions:f}}};return(i,d)=>(m(),w("div",Vo,[o("div",To,[o("label",qo,[G(k(e(l)("questionEditor.name"))+" ",1),d[4]||(d[4]=o("span",{class:"text-red-500"},"*",-1))]),(m(),w("input",{key:`question-name-${n.modelValue.id}`,value:t.value.name,type:"text",readonly:n.readonly,disabled:n.readonly,class:T(["w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2",p.value.name?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-blue-500",n.readonly?"bg-gray-50 cursor-not-allowed":""]),placeholder:e(l)("questionEditor.namePlaceholder"),onInput:d[0]||(d[0]=c=>_(c.target.value))},null,42,Oo)),p.value.name?(m(),w("p",Ro,k(p.value.name),1)):R("",!0)]),o("div",Ao,[o("label",zo,k(e(l)("questionEditor.questionText")),1),o("div",No,[g(pe,{"model-value":t.value.slide,placeholder:e(l)("questionEditor.questionTextPlaceholder"),readonly:n.readonly,"onUpdate:modelValue":E},null,8,["model-value","placeholder","readonly"])])]),o("div",Bo,[o("label",Mo,k(e(l)("questionEditor.inputRule")),1),o("div",Uo,[o("label",{class:T(["flex items-center gap-2",n.readonly?"":"cursor-pointer"])},[o("input",{type:"radio",checked:t.value.inputRule.type==="single",disabled:n.readonly,class:"w-4 h-4 text-blue-600 focus:ring-blue-500 disabled:cursor-not-allowed",onChange:d[1]||(d[1]=c=>V("single"))},null,40,Lo),o("span",Qo,k(e(l)("questionEditor.singleChoice")),1)],2),o("label",{class:T(["flex items-center gap-2",n.readonly?"":"cursor-pointer"])},[o("input",{type:"radio",checked:t.value.inputRule.type==="multiple",disabled:n.readonly,class:"w-4 h-4 text-blue-600 focus:ring-blue-500 disabled:cursor-not-allowed",onChange:d[2]||(d[2]=c=>V("multiple"))},null,40,Po),o("span",jo,k(e(l)("questionEditor.multipleChoice")),1)],2)])]),o("div",Do,[o("label",Ho,[G(k(e(l)("questionEditor.options"))+" ",1),d[5]||(d[5]=o("span",{class:"text-red-500"},"*",-1))]),o("div",{class:T(["border rounded-md p-3 space-y-2",p.value.options?"border-red-500":"border-gray-300"])},[g(e(ce),{modelValue:u.value,"onUpdate:modelValue":d[3]||(d[3]=c=>u.value=c),"item-key":"id",tag:"div",class:"space-y-2",animation:200,disabled:n.readonly,handle:n.readonly?"":".drag-handle",onChange:b},{default:O(()=>[(m(!0),w(le,null,se(u.value,(c,f)=>(m(),w("div",{key:c.id,class:"relative flex items-center gap-2 px-2 py-1 border border-gray-200 rounded-md hover:bg-gray-50"},[n.readonly?R("",!0):(m(),w("button",{key:0,type:"button",class:"drag-handle text-gray-400 cursor-move hover:text-gray-600 shrink-0 flex items-center",title:e(l)("common.drag")},[g(e(de),{size:18})],8,Fo)),o("div",Go,[t.value.inputRule.type==="single"?(m(),w("input",{key:0,type:"radio",checked:t.value.inputRule.correctOptions.includes(f),disabled:n.readonly||!c.text.trim(),class:"w-4 h-4 text-blue-600 focus:ring-blue-500 disabled:cursor-not-allowed",name:`correct-${t.value.id}`,onChange:S=>U(f)},null,40,Ko)):(m(),w("input",{key:1,type:"checkbox",checked:t.value.inputRule.correctOptions.includes(f),disabled:n.readonly||!c.text.trim(),class:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500 disabled:cursor-not-allowed",onChange:S=>U(f)},null,40,Wo))]),o("div",Yo,[Z(o("input",{"onUpdate:modelValue":S=>c.text=S,type:"text",readonly:n.readonly,disabled:n.readonly,class:T(["w-full px-2 py-1 text-sm border rounded focus:outline-none focus:ring-1",p.value.optionTexts?.[f]?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-blue-500",n.readonly?"bg-gray-50 cursor-not-allowed":""]),placeholder:e(l)("questionEditor.optionPlaceholder"),onInput:S=>q(f)},null,42,Xo),[[ee,c.text]])]),p.value.optionTexts?.[f]?(m(),w("div",Jo,[o("p",Zo,k(p.value.optionTexts[f]),1)])):R("",!0),o("button",{type:"button",disabled:n.readonly||t.value.options.length<=2,class:T(["shrink-0 p-1 text-gray-400 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",n.readonly?"":"hover:text-red-600"]),title:n.readonly?"":e(l)("common.delete"),onClick:S=>N(f)},[g(e(re),{size:16})],10,en)]))),128))]),_:1},8,["modelValue","disabled","handle"]),n.readonly?R("",!0):(m(),w("button",{key:0,type:"button",class:"w-full px-3 py-2 text-sm text-gray-600 border border-gray-300 border-dashed rounded-md hover:bg-gray-50 hover:border-gray-400 transition-colors",onClick:$}," + "+k(e(l)("questionEditor.addOption")),1)),p.value.options?(m(),w("p",tn,k(p.value.options),1)):R("",!0)],2)])]))}}),nn={class:"fixed inset-0 flex items-center justify-center p-4"},ln={class:"flex items-center justify-between p-6 border-b"},sn={class:"p-6 overflow-y-auto flex-1"},an={class:"flex items-center justify-end gap-3 p-6 border-t bg-gray-50"},dn=["disabled"],rn=["disabled"],un=P({__name:"StepEditorModal",props:{step:{},open:{type:Boolean},stepType:{}},emits:["update:open","save"],setup(h,{emit:x}){const{t:l}=H(),n=h,s=x,t=I(null),u=I(null),p=I(!1),a=I(!1),b=A(()=>n.step===null),_=A(()=>n.step?.type==="slide"||!n.step&&n.stepType==="slide"),E=A(()=>n.step?.type==="question"||!n.step&&n.stepType==="question"),V=A(()=>t.value?`slide-${t.value.id}-${n.open}`:"new-slide"),$=A(()=>u.value?`question-${u.value.id}-${n.open}`:"new-question");j(()=>n.open,c=>{c&&(n.step?(n.step.type==="slide"?(t.value={id:n.step.id,type:n.step.type,name:n.step.name,content:n.step.content},u.value=null):(u.value={id:n.step.id,type:n.step.type,name:n.step.name,slide:n.step.slide,options:[...n.step.options],inputRule:{type:n.step.inputRule.type,correctOptions:[...n.step.inputRule.correctOptions]}},t.value=null),p.value=!0,a.value=!0):(n.stepType==="slide"?(t.value={id:`slide-${Math.random().toString(36).substr(2,9)}`,type:"slide",name:"",content:""},u.value=null):(u.value={id:`question-${Math.random().toString(36).substr(2,9)}`,type:"question",name:"",slide:"",options:["",""],inputRule:{type:"single",correctOptions:[]}},t.value=null,a.value=!1),p.value=!1))});const q=c=>{t.value=c},N=c=>{u.value=c},U=()=>{s("update:open",!1)},i=()=>{!t.value||!p.value||(s("save",t.value),s("update:open",!1))},d=()=>{!u.value||!a.value||(s("save",u.value),s("update:open",!1))};return(c,f)=>(m(),M(e(Ee),{show:h.open,as:"template"},{default:O(()=>[g(e(Ve),{open:h.open,onClose:U,class:"relative z-60"},{default:O(()=>[g(e(ne),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:O(()=>[...f[2]||(f[2]=[o("div",{class:"fixed inset-0 bg-black/30"},null,-1)])]),_:1}),o("div",nn,[g(e(ne),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:O(()=>[g(e(Se),{class:"w-full max-w-3xl h-full max-h-[90vh] bg-white rounded-lg shadow-xl flex flex-col"},{default:O(()=>[o("div",ln,[g(e(Ce),{class:"text-lg font-semibold"},{default:O(()=>[G(k(b.value?e(l)("stepEditorModal.createTitle"):e(l)("stepEditorModal.editTitle"))+" "+k(h.stepType==="slide"?e(l)("stepEditorModal.slide"):e(l)("stepEditorModal.question")),1)]),_:1}),o("button",{type:"button",class:"rounded p-1 hover:bg-gray-100",onClick:U},[g(e(Ie),{size:20,class:"text-gray-500"})])]),o("div",sn,[_.value&&t.value?(m(),M(Io,{key:V.value,"model-value":t.value,"onUpdate:modelValue":q,"onUpdate:valid":f[0]||(f[0]=S=>p.value=S)},null,8,["model-value"])):R("",!0),E.value&&u.value?(m(),M(on,{key:$.value,"model-value":u.value,"onUpdate:modelValue":N,"onUpdate:valid":f[1]||(f[1]=S=>a.value=S)},null,8,["model-value"])):R("",!0)]),o("div",an,[o("button",{type:"button",class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",onClick:U},k(e(l)("common.cancel")),1),_.value?(m(),w("button",{key:0,type:"button",class:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!p.value,onClick:i},k(e(l)("common.save")),9,dn)):R("",!0),E.value?(m(),w("button",{key:1,type:"button",class:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!a.value,onClick:d},k(e(l)("common.save")),9,rn)):R("",!0)])]),_:1})]),_:1})])]),_:1},8,["open"])]),_:1},8,["show"]))}}),cn={class:"mx-auto max-w-2xl"},pn={class:"rounded-lg border border-gray-200 bg-white shadow-sm"},vn={class:"p-4 border-b border-gray-100"},mn={class:"text-lg font-semibold"},yn={class:"block text-sm font-medium text-gray-700 mb-1"},fn=["placeholder"],bn={class:"grid grid-cols-1 gap-4"},gn={class:"block text-sm font-medium text-gray-700 mb-1"},hn=["placeholder"],xn={class:"block text-sm font-medium text-gray-700 mb-1"},_n=["placeholder"],kn={class:"block text-sm font-medium text-gray-700 mb-1"},$n={key:0,class:"mt-1 text-xs text-red-500"},wn={class:"block text-sm font-medium text-gray-700 mb-1"},En={class:"p-4 border-t border-gray-200 flex gap-2 justify-end"},Sn=["disabled"],An=P({__name:"CourseEditorPage",setup(h){const{t:x}=H(),l=I(0),n=A(()=>[{label:x("courseEditor.tabGeneral")},{label:x("courseEditor.tabDescription")},{label:x("courseEditor.tabStructure")}]),s=je(),t=Pe(),u=Ke,p=I(null),a=I(""),b=I(null),_=I(""),E=I(""),V=I(""),$=I([]),q=I([]),N=A(()=>d.value?.objectId&&typeof d.value.objectId=="string"?d.value.objectId:null),U=async()=>{q.value=await He(u)},i=A(()=>t.path==="/course/new"),d=A(()=>p.value!=null?q.value.find(y=>y.id===p.value&&y.deletedAt===null)??null:null),c=A(()=>!!(a.value.trim()&&b.value!=null)),f=y=>{const v=y.split("/").filter(Boolean).map(C=>Number(C)).filter(C=>Number.isFinite(C)),r=v.length>0?v[v.length-1]:void 0;return r??null};_e(async()=>{if(await U(),i.value){const y=t.query.parentId;if(y){const v=Number(y);Number.isFinite(v)&&(b.value=v)}p.value=null}else{const v=(t.params.path||"").replace(/\/edit$/,""),r=v.endsWith("/")?v:`${v}/`;if(p.value=f(r),d.value&&d.value.type==="leaf"){a.value=d.value.name,b.value=d.value.parentId??null;const C=d.value.objectId;if(typeof C=="string"&&C){const L=De(C);L&&L.deletedAt===null&&(_.value=L.author,E.value=L.fullName,V.value=L.description,$.value=L.structure||[])}else E.value=a.value,$.value=[]}else s.push({path:"/"})}});const S=async()=>{if(!(!a.value.trim()||b.value==null))if(i.value){const y=await me({author:_.value,fullName:E.value||a.value.trim(),description:V.value,structure:[]});await Fe(u,b.value,{name:a.value.trim(),type:"leaf"}),await U();const v=q.value.filter(r=>r.deletedAt===null).filter(r=>r.parentId===b.value).filter(r=>r.name===a.value.trim()).filter(r=>r.type==="leaf").sort((r,C)=>C.id-r.id)[0];if(v&&await ye(u,v.id,y.id),v&&typeof y.id=="string")s.push({path:`/course${v.path}`});else{const r=b.value?q.value.find(C=>C.id===b.value)?.path??"/":"/";s.push({path:r})}}else{if(!p.value)return;const y=d.value?.objectId;if(typeof y=="string"&&y)await fe(y,{author:_.value,fullName:E.value,description:V.value,structure:$.value});else{const r=await me({author:_.value,fullName:E.value||a.value.trim(),description:V.value,structure:[]});await ye(u,p.value,r.id)}await Ge(u,p.value,a.value.trim(),b.value);const v=d.value;if(v)s.push({path:`/course${v.path}`});else{const r=b.value?q.value.find(C=>C.id===b.value)?.path??"/":"/";s.push({path:r})}}},F=()=>{if(i.value){const y=b.value?q.value.find(v=>v.id===b.value)?.path??"/":"/";s.push({path:y})}else{const y=d.value;y?s.push({path:`/course${y.path}`}):s.push({path:"/"})}},B=async y=>{$.value=y,N.value&&await fe(N.value,{structure:y})},z=I(!1),Q=I(null),te=()=>{Q.value=null,z.value=!0},Te=y=>{const v=$.value.find(r=>r.id===y.sectionId);v&&(Q.value={...v},z.value=!0)},qe=y=>{const v=$.value.find(L=>L.id===y.sectionId);if(!v||!window.confirm(`${x("common.delete")} "${v.name}"?`))return;const C=$.value.filter(L=>L.id!==y.sectionId);B(C)},Oe=y=>{if(Q.value===null)B([...$.value,y]);else{const v=$.value.map(r=>r.id===y.id?y:r);B(v)}z.value=!1,Q.value=null},W=I(!1),Y=I(null),X=I("slide"),K=I(null),Re=y=>{K.value=y.sectionId,X.value="slide",Y.value=null,W.value=!0},Ae=y=>{K.value=y.sectionId,X.value="question",Y.value=null,W.value=!0},ze=y=>{const v=$.value.find(C=>C.id===y.sectionId);if(!v)return;const r=v.steps.find(C=>C.id===y.stepId);!r||r.type!=="slide"||(K.value=y.sectionId,X.value="slide",Y.value={...r},W.value=!0)},Ne=y=>{const v=$.value.find(C=>C.id===y.sectionId);if(!v)return;const r=v.steps.find(C=>C.id===y.stepId);!r||r.type!=="question"||(K.value=y.sectionId,X.value="question",Y.value={...r,options:[...r.options],inputRule:{...r.inputRule,correctOptions:[...r.inputRule.correctOptions]}},W.value=!0)},Be=y=>{const v=$.value.find(D=>D.id===y.sectionId);if(!v)return;const r=v.steps.find(D=>D.id===y.stepId);if(!r||!window.confirm(`${x("common.delete")} "${r.name||x("stepList.unnamedStep")}"?`))return;const L=$.value.map(D=>D.id===y.sectionId?{...D,steps:D.steps.filter(J=>J.id!==y.stepId)}:D);B(L)},Me=y=>{if(!K.value||!$.value.find(C=>C.id===K.value))return;const r=$.value.map(C=>{if(C.id===K.value){const L=C.steps.findIndex(J=>J.id===y.id),D=L>=0?C.steps.map((J,Ue)=>Ue===L?y:J):[...C.steps,y];return{...C,steps:D}}return C});B(r),W.value=!1,Y.value=null,K.value=null};return(y,v)=>(m(),w("div",cn,[o("div",pn,[o("div",vn,[o("h1",mn,k(i.value?e(x)("courseEditor.newTitle"):e(x)("courseEditor.title")),1)]),g(e(vt),{"selected-index":l.value,onChange:v[5]||(v[5]=r=>l.value=r)},{default:O(()=>[g(e(mt),{class:"flex border-b border-gray-200"},{default:O(()=>[(m(!0),w(le,null,se(n.value,(r,C)=>(m(),M(e(yt),{key:C,as:"button",type:"button",class:T(["px-4 py-2 text-sm font-medium focus:outline-none transition-colors",l.value===C?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700"])},{default:O(()=>[G(k(r.label),1)]),_:2},1032,["class"]))),128))]),_:1}),g(e(ft),{class:"p-4"},{default:O(()=>[g(e(ae),{class:"space-y-4"},{default:O(()=>[o("div",null,[o("label",yn,k(e(x)("courseEditor.nameLabel")),1),Z(o("input",{"onUpdate:modelValue":v[0]||(v[0]=r=>a.value=r),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:e(x)("courseEditor.namePlaceholder")},null,8,fn),[[ee,a.value]])]),o("div",bn,[o("div",null,[o("label",gn,k(e(x)("courseEditor.fullName")),1),Z(o("input",{"onUpdate:modelValue":v[1]||(v[1]=r=>E.value=r),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:e(x)("courseEditor.fullNamePlaceholder")},null,8,hn),[[ee,E.value]])]),o("div",null,[o("label",xn,k(e(x)("courseEditor.author")),1),Z(o("input",{"onUpdate:modelValue":v[2]||(v[2]=r=>_.value=r),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:e(x)("courseEditor.authorPlaceholder")},null,8,_n),[[ee,_.value]])])]),o("div",null,[o("label",kn,k(e(x)("common.folder")),1),g(We,{"forest-id":e(u),"current-folder-id":p.value,value:b.value,"allow-root":!1,"onUpdate:value":v[3]||(v[3]=r=>b.value=r)},null,8,["forest-id","current-folder-id","value"]),b.value?R("",!0):(m(),w("p",$n,k(e(x)("courseEditor.folderRequired")),1))])]),_:1}),g(e(ae),null,{default:O(()=>[o("div",null,[o("label",wn,k(e(x)("courseEditor.description")),1),g(pe,{class:"min-h-[180px]",key:"description-editor",modelValue:V.value,"onUpdate:modelValue":v[4]||(v[4]=r=>V.value=r),placeholder:e(x)("courseEditor.descriptionPlaceholder")},null,8,["modelValue","placeholder"])])]),_:1}),!i.value&&N.value?(m(),M(e(ae),{key:0},{default:O(()=>[g(uo,{structure:$.value,class:"min-h-full","onUpdate:structure":B,onAddSection:te,onEditSectionName:Te,onDeleteSection:qe,onAddSlide:Re,onAddQuestion:Ae,onEditSlide:ze,onEditQuestion:Ne,onDeleteStep:Be},null,8,["structure"])]),_:1})):R("",!0)]),_:1})]),_:1},8,["selected-index"]),o("div",En,[o("button",{type:"button",class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",onClick:F},k(e(x)("common.cancel")),1),o("button",{type:"button",class:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!c.value,onClick:S},k(i.value?e(x)("common.create"):e(x)("common.save")),9,Sn)])]),g(ho,{section:Q.value,open:z.value,"onUpdate:open":v[6]||(v[6]=r=>z.value=r),onSave:Oe},null,8,["section","open"]),g(un,{step:Y.value,open:W.value,"step-type":X.value,"onUpdate:open":v[7]||(v[7]=r=>W.value=r),onSave:Me},null,8,["step","open","step-type"])]))}});export{An as default};
