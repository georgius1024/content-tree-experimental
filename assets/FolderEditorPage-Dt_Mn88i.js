import{d as I,E as P,r as f,b as _,U as E,o as k,M as F,y as B,A as o,D as p,u as s,V as C,W as T,I as V,z as A}from"./vue-vendor-DSdsonjH.js";import{C as D,g as M,b as R,u as S}from"./index-BzoJvuOE.js";import{_ as U}from"./FolderPicker.vue_vue_type_script_setup_true_lang-CX6BlbvN.js";import"./ui-BLgiSNLv.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const z={class:"mx-auto max-w-2xl"},O={class:"rounded-lg border border-gray-200 bg-white shadow-sm"},W={class:"p-4 border-b border-gray-100"},$={class:"text-lg font-semibold"},j={class:"p-4 space-y-4"},q={class:"block text-sm font-medium text-gray-700 mb-1"},G=["placeholder"],H={class:"block text-sm font-medium text-gray-700 mb-1"},J={class:"flex gap-2 justify-end"},K=["disabled"],te=I({__name:"FolderEditorPage",setup(L){const{t:n}=P(),u=F(),h=E(),m=D,d=f(null),r=f(""),a=f(null),i=f([]),g=async()=>{i.value=await M(m)},c=_(()=>h.path==="/folder/new"),v=_(()=>d.value!=null?i.value.find(e=>e.id===d.value&&e.deletedAt===null)??null:null),y=_(()=>!!r.value.trim()),x=e=>{const t=e.split("/").filter(Boolean).map(b=>Number(b)).filter(b=>Number.isFinite(b)),l=t.length>0?t[t.length-1]:void 0;return l??null};k(async()=>{if(await g(),c.value){const e=h.query.parentId;if(e){const t=Number(e);Number.isFinite(t)&&(a.value=t)}d.value=null}else{const e=h.params.path||"",t=e.endsWith("/")?e:`${e}/`;d.value=x(t),v.value?(r.value=v.value.name,a.value=v.value.parentId??null):u.push({path:"/"})}});const w=async()=>{if(r.value.trim())if(c.value){await R(m,a.value,{name:r.value.trim(),type:"branch"});const e=a.value?i.value.find(t=>t.id===a.value)?.path??"/":"/";u.push({path:e})}else{if(!d.value)return;await S(m,d.value,r.value.trim(),a.value);const e=a.value?i.value.find(t=>t.id===a.value)?.path??"/":"/";u.push({path:e})}},N=()=>{if(c.value){const e=a.value?i.value.find(t=>t.id===a.value)?.path??"/":"/";u.push({path:e})}else{const e=v.value;if(e){const t=e.parentId?i.value.find(l=>l.id===e.parentId&&l.deletedAt===null)?.path??"/":"/";u.push({path:t})}else u.push({path:"/"})}};return(e,t)=>(A(),B("div",z,[o("div",O,[o("div",W,[o("h1",$,p(c.value?s(n)("folderEditor.newTitle"):s(n)("folderEditor.title")),1)]),o("div",j,[o("div",null,[o("label",q,p(s(n)("common.name")),1),C(o("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>r.value=l),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:s(n)("folderEditor.namePlaceholder")},null,8,G),[[T,r.value]])]),o("div",null,[o("label",H,p(s(n)("common.parent")),1),V(U,{"forest-id":s(m),"current-folder-id":d.value,"exclude-descendants-of":d.value,value:a.value,"allow-root":!0,"onUpdate:value":t[1]||(t[1]=l=>a.value=l)},null,8,["forest-id","current-folder-id","exclude-descendants-of","value"])]),o("div",J,[o("button",{type:"button",class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",onClick:N},p(s(n)("common.cancel")),1),o("button",{type:"button",class:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!y.value,onClick:w},p(c.value?s(n)("common.create"):s(n)("common.save")),9,K)])])])]))}});export{te as default};
