import{d as E,r as T,b as u,e as L,G as C,u as i,H as k,A as n,I as h,C as S,y as B,S as c,V as P,W as M,K as z,x as D,F as N,D as H,z as x,n as $,E as A,o as U}from"./vue-vendor-DSdsonjH.js";import{v as q,w as G,z as O,A as Q,D as W,E as _,H as j}from"./ui-BLgiSNLv.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as J,g as X}from"./index-BjQVUTM4.js";const Y={class:"relative"},Z={class:"relative"},ee={class:"block truncate text-sm"},te=["innerHTML"],oe={key:1,class:"absolute z-10 mt-1 w-full rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm"},le={class:"relative"},re={class:"px-3 py-2 text-sm text-gray-500 text-center"},se=E({__name:"GeneralFolderPicker",props:{folders:{},selectedFolderId:{},getFolderPath:{},onSelect:{},allowRoot:{type:Boolean,default:!0},rootText:{default:"Root"},selectFolderButtonText:{default:"Select folder"},noFoldersFoundText:{default:"No folders found"}},setup(p){const l=p,r=T(""),g=T(null),b=T(null),f=t=>{const e=document.createElement("div");return e.textContent=t,e.innerHTML},w=t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),F=(t,e)=>{if(!e.trim())return f(t);const o=new RegExp(`(${w(e)})`,"gi");return f(t).replace(o,'<mark class="bg-yellow-200">$1</mark>')},m=(t,e)=>e.trim()?t.toLowerCase().includes(e.toLowerCase()):!0,I=u(()=>{const t=r.value.trim();return t?l.folders.filter(e=>{const o=l.getFolderPath(e);return m(o,t)||m(e.name,t)}):l.folders}),R=u(()=>{if(!l.allowRoot)return!1;const t=r.value.trim().toLowerCase();if(!t)return!0;const e=l.rootText.toLowerCase();return m(e,t)||m("root",t)}),y=u(()=>{const t=[],e=r.value.trim();return R.value&&t.push({id:"root",folder:null,highlightedText:F(l.rootText,e)}),I.value.forEach(o=>{const d=l.getFolderPath(o);t.push({id:o.id,folder:o,highlightedText:F(d,e)})}),t}),v=u({get(){return l.selectedFolderId==null?null:l.folders.find(t=>t.id===l.selectedFolderId)??null},set(t){l.onSelect(t?.id??null),r.value=""}}),s=u(()=>v.value?l.getFolderPath(v.value):l.allowRoot?l.rootText:l.selectFolderButtonText),a=async()=>{await $();const t=b.value?.$el;if(t){const e=t.parentElement,o=e?.querySelector("button[data-headlessui-state]")||e?.querySelector("button");o&&o.click()}};return L(()=>l.selectedFolderId,()=>{r.value=""}),(t,e)=>(x(),C(i(q),{modelValue:v.value,"onUpdate:modelValue":e[10]||(e[10]=o=>v.value=o),as:"div",nullable:""},{default:k(()=>[n("div",Y,[h(i(G),{ref_key:"inputRef",ref:b,"model-value":s.value,readonly:"",class:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-md text-left bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 cursor-pointer","display-value":()=>s.value,onClick:a},null,8,["model-value","display-value"]),h(i(Q),{ref_key:"buttonRef",ref:g,class:"absolute inset-y-0 right-0 flex items-center pr-2"},{default:k(()=>[h(i(O),{class:"h-5 w-5 text-gray-400","aria-hidden":"true"})]),_:1},512),y.value.length>0?(x(),C(i(W),{key:0,class:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm"},{default:k(()=>[n("div",{class:"sticky top-0 bg-white border-b border-gray-200 px-3 py-2 z-10",onClick:e[3]||(e[3]=c(()=>{},["stop"])),onMousedown:e[4]||(e[4]=c(()=>{},["stop"])),style:{"pointer-events":"auto"}},[n("div",Z,[h(i(_),{class:"absolute left-2 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400 pointer-events-none"}),P(n("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>r.value=o),type:"search",disabled:!1,class:"w-full pl-8 pr-2 py-1.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Search folders...",onClick:e[1]||(e[1]=c(()=>{},["stop"])),onMousedown:e[2]||(e[2]=c(()=>{},["stop"])),style:{"pointer-events":"auto"}},null,544),[[M,r.value]])])],32),(x(!0),B(N,null,z(y.value,o=>(x(),C(i(j),{key:o.id??"root",value:o.folder,as:"template"},{default:k(({active:d,selected:V})=>[n("li",{class:D(["relative cursor-pointer select-none px-3 py-2",{"bg-blue-600 text-white":d,"bg-gray-100":V&&!d,"text-gray-900":!d}])},[n("span",ee,[n("span",{innerHTML:o.highlightedText},null,8,te)])],2)]),_:2},1032,["value"]))),128))]),_:1})):S("",!0),y.value.length===0?(x(),B("div",oe,[n("div",{class:"sticky top-0 bg-white border-b border-gray-200 px-3 py-2 z-10",onClick:e[8]||(e[8]=c(()=>{},["stop"])),onMousedown:e[9]||(e[9]=c(()=>{},["stop"])),style:{"pointer-events":"auto"}},[n("div",le,[h(i(_),{class:"absolute left-2 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400 pointer-events-none"}),P(n("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>r.value=o),type:"search",disabled:!1,class:"w-full pl-8 pr-2 py-1.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Search folders...",onClick:e[6]||(e[6]=c(()=>{},["stop"])),onMousedown:e[7]||(e[7]=c(()=>{},["stop"])),style:{"pointer-events":"auto"}},null,544),[[M,r.value]])])],32),n("div",re,H(p.noFoldersFoundText),1)])):S("",!0)])]),_:1},8,["modelValue"]))}}),ne=K(se,[["__scopeId","data-v-b94ad8a2"]]),ce=E({__name:"FolderPicker",props:{forestId:{},currentFolderId:{},value:{},excludeDescendantsOf:{default:null},allowRoot:{type:Boolean,default:!0}},emits:["update:value"],setup(p,{emit:l}){const{t:r}=A(),g=p,b=l,f=T([]),w=async()=>{f.value=await X(g.forestId)};U(()=>{w()}),L(()=>g.forestId,()=>{w()});const F=u(()=>{const s=g.excludeDescendantsOf;return f.value.filter(a=>a.deletedAt===null&&a.type!=="leaf").filter(a=>{if(!s||!a.path)return!0;const t=f.value.find(e=>e.id===s);return t?!a.path.startsWith(t.path):!0}).sort(J)}),m=s=>{const a=s.path.split("/").filter(Boolean).map(e=>Number(e)).filter(e=>Number.isFinite(e)),t=[];return a.forEach(e=>{const o=f.value.find(d=>d.id===e&&d.deletedAt===null);o&&t.push(o.name)}),t.length>0?t.join(" / "):s.name},I=u(()=>r("folderPicker.root")),R=u(()=>r("folderPicker.selectFolderButton")),y=u(()=>r("folderPicker.noFoldersFound")),v=s=>{b("update:value",s)};return(s,a)=>(x(),C(ne,{folders:F.value,"selected-folder-id":p.value,"get-folder-path":m,"on-select":v,"allow-root":p.allowRoot,"root-text":I.value,"select-folder-button-text":R.value,"no-folders-found-text":y.value},null,8,["folders","selected-folder-id","allow-root","root-text","select-folder-button-text","no-folders-found-text"]))}});export{ce as _};
