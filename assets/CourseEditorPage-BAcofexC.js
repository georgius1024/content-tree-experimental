import{d as P,E as H,e as j,a as xe,y as E,x as T,C as R,I as g,u as e,A as o,z as p,r as I,b as A,o as _e,X as Le,B as ie,n as Qe,G as U,Y as ve,H as O,L as G,D as k,S as oe,F as le,K as se,V as Z,W as ee,U as Pe,M as je}from"./vue-vendor-DSdsonjH.js";import{c as De,g as He,e as me,b as Fe,f as ye,h as be,u as Ge,C as Ke}from"./index-D7UIgnPN.js";import{_ as We}from"./FolderPicker.vue_vue_type_script_setup_true_lang-ByFMYPlx.js";import{u as Ye,i as Xe,a as Je,b as Ze,E as et}from"./tiptap-D4bq3STi.js";import{d as tt,I as ot,U as nt,e as lt,L as st,f as at,Q as it,h as dt,i as rt,j as ut,R as ct,k as fe,l as ge,F as he,G as de,m as ke,n as $e,P as we,T as re,o as pt,p as Ee,q as ne,r as Se,V as Ce,X as Ie,Y as Ve,s as vt,t as mt,x as yt,u as bt,y as ae}from"./ui-BLgiSNLv.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as ce}from"./vue-draggable-next.esm-bundler-DB3MgKZV.js";const ft={key:0,class:"flex flex-wrap items-center gap-1 p-2 border-b border-gray-200 bg-gray-50 rounded-t-md"},gt=["title"],ht=["title"],xt=["title"],_t=["title"],kt=["title"],$t=["title"],wt=["title"],Et=["title"],St=["title"],Ct=["title"],It=["title"],Vt=["title"],Tt=["title","disabled"],qt=["title","disabled"],Ot=P({__name:"RichTextEditor",props:{modelValue:{},placeholder:{},readonly:{type:Boolean}},emits:["update:modelValue"],setup(h,{emit:x}){const l=h,n=x,{t:s}=H(),t=Ye({extensions:[Xe.configure({heading:{levels:[1,2,3]},link:!1,underline:!1}),Je,Ze.configure({openOnClick:!1,HTMLAttributes:{class:"text-blue-600 underline"}})],content:l.modelValue,editable:!l.readonly,onUpdate:({editor:c})=>{l.readonly||n("update:modelValue",c.getHTML())},editorProps:{attributes:{class:"rich-text-content px-3 py-2 border-0 focus:outline-none focus:ring-0","data-placeholder":l.placeholder||""}}}),r=()=>{if(!t.value)return;const c=t.value.getAttributes("link").href,a=window.prompt(s("richTextEditor.link"),c);if(a!==null){if(a===""){t.value.chain().focus().extendMarkRange("link").unsetLink().run();return}t.value.chain().focus().extendMarkRange("link").setLink({href:a}).run()}};return j(()=>l.modelValue,c=>{t.value?.getHTML()!==c&&t.value?.commands.setContent(c)}),j(()=>l.readonly,c=>{t.value&&t.value.setEditable(!c)},{immediate:!0}),xe(()=>{t.value?.destroy()}),(c,a)=>(p(),E("div",{class:T(["rich-text-editor",{"readonly-mode":l.readonly}])},[e(t)&&!l.readonly?(p(),E("div",ft,[o("button",{type:"button",class:T(["p-1.5 rounded hover:bg-gray-200 transition-colors",e(t).isActive("bold")?"bg-gray-300":""]),title:e(s)("richTextEditor.bold"),onClick:a[0]||(a[0]=f=>e(t).chain().focus().toggleBold().run())},[g(e(tt),{size:16,class:"text-gray-700"})],10,gt),o("button",{type:"button",class:T(["p-1.5 rounded hover:bg-gray-200 transition-colors",e(t).isActive("italic")?"bg-gray-300":""]),title:e(s)("richTextEditor.italic"),onClick:a[1]||(a[1]=f=>e(t).chain().focus().toggleItalic().run())},[g(e(ot),{size:16,class:"text-gray-700"})],10,ht),o("button",{type:"button",class:T(["p-1.5 rounded hover:bg-gray-200 transition-colors",e(t).isActive("underline")?"bg-gray-300":""]),title:e(s)("richTextEditor.underline"),onClick:a[2]||(a[2]=f=>e(t).chain().focus().toggleUnderline().run())},[g(e(nt),{size:16,class:"text-gray-700"})],10,xt),o("button",{type:"button",class:T(["p-1.5 rounded hover:bg-gray-200 transition-colors",e(t).isActive("strike")?"bg-gray-300":""]),title:e(s)("richTextEditor.strike"),onClick:a[3]||(a[3]=f=>e(t).chain().focus().toggleStrike().run())},[g(e(lt),{size:16,class:"text-gray-700"})],10,_t),a[13]||(a[13]=o("div",{class:"w-px h-6 bg-gray-300 mx-1"},null,-1)),o("button",{type:"button",class:T(["px-2 py-1 rounded text-sm hover:bg-gray-200 transition-colors",e(t).isActive("heading",{level:1})?"bg-gray-300 font-semibold":""]),title:e(s)("richTextEditor.heading1"),onClick:a[4]||(a[4]=f=>e(t).chain().focus().toggleHeading({level:1}).run())}," H1 ",10,kt),o("button",{type:"button",class:T(["px-2 py-1 rounded text-sm hover:bg-gray-200 transition-colors",e(t).isActive("heading",{level:2})?"bg-gray-300 font-semibold":""]),title:e(s)("richTextEditor.heading2"),onClick:a[5]||(a[5]=f=>e(t).chain().focus().toggleHeading({level:2}).run())}," H2 ",10,$t),o("button",{type:"button",class:T(["px-2 py-1 rounded text-sm hover:bg-gray-200 transition-colors",e(t).isActive("heading",{level:3})?"bg-gray-300 font-semibold":""]),title:e(s)("richTextEditor.heading3"),onClick:a[6]||(a[6]=f=>e(t).chain().focus().toggleHeading({level:3}).run())}," H3 ",10,wt),a[14]||(a[14]=o("div",{class:"w-px h-6 bg-gray-300 mx-1"},null,-1)),o("button",{type:"button",class:T(["p-1.5 rounded hover:bg-gray-200 transition-colors",e(t).isActive("bulletList")?"bg-gray-300":""]),title:e(s)("richTextEditor.bulletList"),onClick:a[7]||(a[7]=f=>e(t).chain().focus().toggleBulletList().run())},[g(e(st),{size:16,class:"text-gray-700"})],10,Et),o("button",{type:"button",class:T(["p-1.5 rounded hover:bg-gray-200 transition-colors",e(t).isActive("orderedList")?"bg-gray-300":""]),title:e(s)("richTextEditor.orderedList"),onClick:a[8]||(a[8]=f=>e(t).chain().focus().toggleOrderedList().run())},[g(e(at),{size:16,class:"text-gray-700"})],10,St),a[15]||(a[15]=o("div",{class:"w-px h-6 bg-gray-300 mx-1"},null,-1)),o("button",{type:"button",class:T(["p-1.5 rounded hover:bg-gray-200 transition-colors",e(t).isActive("blockquote")?"bg-gray-300":""]),title:e(s)("richTextEditor.blockquote"),onClick:a[9]||(a[9]=f=>e(t).chain().focus().toggleBlockquote().run())},[g(e(it),{size:16,class:"text-gray-700"})],10,Ct),o("button",{type:"button",class:T(["p-1.5 rounded hover:bg-gray-200 transition-colors",e(t).isActive("codeBlock")?"bg-gray-300":""]),title:e(s)("richTextEditor.codeBlock"),onClick:a[10]||(a[10]=f=>e(t).chain().focus().toggleCodeBlock().run())},[g(e(dt),{size:16,class:"text-gray-700"})],10,It),a[16]||(a[16]=o("div",{class:"w-px h-6 bg-gray-300 mx-1"},null,-1)),o("button",{type:"button",class:T(["p-1.5 rounded hover:bg-gray-200 transition-colors",e(t).isActive("link")?"bg-gray-300":""]),title:e(t).isActive("link")?e(s)("richTextEditor.unlink"):e(s)("richTextEditor.link"),onClick:r},[g(e(rt),{size:16,class:"text-gray-700"})],10,Vt),a[17]||(a[17]=o("div",{class:"w-px h-6 bg-gray-300 mx-1"},null,-1)),o("button",{type:"button",class:"p-1.5 rounded hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:e(s)("richTextEditor.undo"),disabled:!e(t).can().undo(),onClick:a[11]||(a[11]=f=>e(t).chain().focus().undo().run())},[g(e(ut),{size:16,class:"text-gray-700"})],8,Tt),o("button",{type:"button",class:"p-1.5 rounded hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:e(s)("richTextEditor.redo"),disabled:!e(t).can().redo(),onClick:a[12]||(a[12]=f=>e(t).chain().focus().redo().run())},[g(e(ct),{size:16,class:"text-gray-700"})],8,qt)])):R("",!0),g(e(et),{editor:e(t),class:"rich-text-content-wrapper"},null,8,["editor"])],2))}}),pe=ue(Ot,[["__scopeId","data-v-09e099cc"]]),Rt=P({__name:"Collapsible",props:{value:{type:Boolean,default:!0},duration:{default:200},transition:{default:"linear"}},setup(h){const x=h,l=I(null),n=I(x.value?"0":"unset"),s=I(x.value?"hidden":"unset"),t=A(()=>({transition:`max-height ${x.transition} ${x.duration}ms`,maxHeight:n.value,overflow:s.value})),r=c=>{l.value&&c.target===l.value&&(x.value||(n.value="unset",s.value="unset"))};return _e(()=>{l.value&&l.value.addEventListener("transitionend",r)}),xe(()=>{l.value&&l.value.removeEventListener("transitionend",r)}),j(()=>x.value,(c,a)=>{a!==c&&l.value&&(n.value==="unset"&&(n.value=`${l.value.scrollHeight}px`,s.value="hidden"),Qe(()=>{setTimeout(()=>{l.value&&(n.value=c?"0":`${l.value.scrollHeight}px`)},0)}))}),(c,a)=>(p(),E("div",{style:Le(t.value),ref_key:"rootEl",ref:l},[ie(c.$slots,"default")],4))}}),At=["aria-expanded"],zt=P({__name:"Accordion",props:{label:{default:""},open:{type:Boolean,default:!1},duration:{default:200},transition:{default:"linear"},caretPosition:{default:"right"},indicatorType:{default:"chevron"},headerHover:{type:Boolean,default:!1},headerGroup:{type:Boolean,default:!1}},emits:["update:open","toggle"],setup(h,{emit:x}){const l=h,n=x,s=I(l.open);j(()=>l.open,_=>{s.value=_});const t=()=>{const _=!s.value;s.value=_,n("update:open",_),n("toggle",_)},r=A(()=>l.duration),c=A(()=>l.transition),a=A(()=>l.label),f=A(()=>l.caretPosition);return(_,S)=>(p(),E("div",null,[o("button",{type:"button",class:T(["flex w-full items-center justify-between gap-2 py-2",f.value==="left"?"pl-2":"",l.headerHover?"hover:bg-gray-50":"",l.headerGroup?"group":""]),"aria-expanded":s.value,onClick:t},[o("div",{class:T(["min-w-0 flex-1 text-left",f.value==="left"?"flex items-center gap-2":""])},[f.value==="left"&&h.indicatorType==="chevron"?(p(),U(e(fe),{key:0,class:T(["shrink-0 transition-transform",s.value?"rotate-90":"rotate-0"]),size:18,"aria-hidden":"true"},null,8,["class"])):f.value==="left"&&h.indicatorType==="folder"?(p(),U(ve(s.value?e(ge):e(he)),{key:1,class:"shrink-0 transition-all",size:18,"aria-hidden":"true"})):R("",!0),ie(_.$slots,"header",{},()=>[G(k(a.value),1)])],2),f.value==="right"&&h.indicatorType==="chevron"?(p(),U(e(fe),{key:0,class:T(["shrink-0 transition-transform",s.value?"rotate-90":"rotate-0"]),size:18,"aria-hidden":"true"},null,8,["class"])):f.value==="right"&&h.indicatorType==="folder"?(p(),U(ve(s.value?e(ge):e(he)),{key:1,class:"shrink-0 transition-all",size:18,"aria-hidden":"true"})):R("",!0)],10,At),g(Rt,{value:!s.value,duration:r.value,transition:c.value},{default:O(()=>[ie(_.$slots,"default")]),_:3},8,["value","duration","transition"])]))}}),Bt={class:"flex items-center justify-between px-2 py-1 text-sm rounded transition hover:bg-gray-50 group"},Mt={class:"inline-flex items-center gap-2 flex-1 min-w-0"},Nt=["title"],Ut={class:"truncate"},Lt={key:0,class:"inline-flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity shrink-0"},Qt=["aria-label"],Pt=["aria-label"],jt=P({__name:"StepListItem",props:{step:{},index:{},readonly:{type:Boolean}},emits:["edit","delete"],setup(h,{emit:x}){const{t:l}=H(),n=x,s=()=>{n("edit")},t=()=>{n("delete")};return(r,c)=>(p(),E("div",Bt,[o("span",Mt,[h.readonly?R("",!0):(p(),E("button",{key:0,type:"button",class:"drag-handle shrink-0 opacity-0 group-hover:opacity-100 transition-opacity text-gray-400 hover:text-gray-600 cursor-move",title:e(l)("common.drag")},[g(e(de),{size:16})],8,Nt)),h.step.type==="slide"?(p(),U(e(ke),{key:1,size:16,class:"text-gray-500 shrink-0","aria-hidden":"true"})):(p(),U(e($e),{key:2,size:16,class:"text-gray-500 shrink-0","aria-hidden":"true"})),o("span",Ut,k(h.step.name||e(l)("stepList.unnamedStep")),1)]),h.readonly?R("",!0):(p(),E("span",Lt,[o("button",{type:"button",class:"rounded p-1 hover:bg-gray-100","aria-label":e(l)("common.edit"),onClick:oe(s,["stop"])},[g(e(we),{size:14,class:"text-gray-500","aria-hidden":"true"})],8,Qt),o("button",{type:"button",class:"rounded p-1 hover:bg-gray-100","aria-label":e(l)("common.delete"),onClick:oe(t,["stop"])},[g(e(re),{size:14,class:"text-gray-500","aria-hidden":"true"})],8,Pt)]))]))}}),Dt={class:"space-y-2"},Ht={key:0,class:"text-center py-8 text-gray-500 text-sm"},Ft={key:2,class:"flex gap-2 pt-2"},Gt=P({__name:"StepList",props:{steps:{},sectionId:{},editable:{type:Boolean,default:!0},readonly:{type:Boolean,default:!1}},emits:["add-slide","add-question","edit-slide","edit-question","delete-step","reorder-steps"],setup(h,{emit:x}){const{t:l}=H(),n=h,s=x,t=I([]);j(()=>n.steps,S=>{t.value=[...S]},{immediate:!0});const r=S=>{if(!S.moved){t.value=[...n.steps];return}const V=t.value.map(w=>w.id);s("reorder-steps",{newOrder:V}),t.value=[...n.steps]},c=()=>{s("add-slide")},a=()=>{s("add-question")},f=S=>{S.type==="slide"?s("edit-slide",{stepId:S.id}):s("edit-question",{stepId:S.id})},_=S=>{s("delete-step",{stepId:S.id})};return(S,V)=>(p(),E("div",Dt,[h.steps.length===0?(p(),E("div",Ht,k(e(l)("stepList.noSteps")),1)):(p(),U(e(ce),{key:1,modelValue:t.value,"onUpdate:modelValue":V[0]||(V[0]=w=>t.value=w),"item-key":"id",tag:"div",class:"space-y-1",animation:200,disabled:h.readonly,handle:".drag-handle",onChange:r},{default:O(()=>[(p(!0),E(le,null,se(t.value,(w,q)=>(p(),U(jt,{key:w.id,step:w,index:q,readonly:h.readonly,onEdit:M=>f(w),onDelete:M=>_(w)},null,8,["step","index","readonly","onEdit","onDelete"]))),128))]),_:1},8,["modelValue","disabled"])),h.editable&&!h.readonly?(p(),E("div",Ft,[o("button",{type:"button",class:"flex-1 px-3 py-2 text-sm text-gray-600 border border-gray-300 border-dashed rounded-md hover:bg-gray-50 hover:border-gray-400 transition-colors inline-flex items-center justify-center gap-2",onClick:c},[g(e(ke),{size:16,class:"text-gray-500"}),o("span",null,k(e(l)("stepList.addSlide")),1)]),o("button",{type:"button",class:"flex-1 px-3 py-2 text-sm text-gray-600 border border-gray-300 border-dashed rounded-md hover:bg-gray-50 hover:border-gray-400 transition-colors inline-flex items-center justify-center gap-2",onClick:a},[g(e($e),{size:16,class:"text-gray-500"}),o("span",null,k(e(l)("stepList.addQuestion")),1)])])):R("",!0)]))}}),Kt=ue(Gt,[["__scopeId","data-v-a4dc60af"]]),Wt={class:"border border-gray-200 rounded-md"},Yt={class:"flex items-center justify-between w-full pr-2"},Xt={class:"flex items-center gap-3 flex-1 min-w-0"},Jt=["title"],Zt={class:"font-medium text-gray-900 truncate"},eo={class:"text-xs font-semibold text-white bg-blue-600 px-2 py-0.5 rounded-full shrink-0"},to={key:0,class:"inline-flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity shrink-0"},oo=["aria-label"],no=["aria-label"],lo={class:"px-4 pb-4 pt-2"},so=P({__name:"SectionAccordion",props:{section:{},sectionIndex:{},readonly:{type:Boolean}},emits:["edit-name","delete","update:section","add-slide","add-question","edit-slide","edit-question","delete-step","reorder-steps"],setup(h,{emit:x}){const{t:l}=H(),n=h,s=x,t=I(!1),r=()=>{s("edit-name")},c=()=>{s("delete")},a=()=>{s("add-slide")},f=()=>{s("add-question")},_=q=>{s("edit-slide",q)},S=q=>{s("edit-question",q)},V=q=>{s("delete-step",q)},w=q=>{const M=new Map(n.section.steps.map(d=>[d.id,d])),L=q.newOrder.map(d=>M.get(d)).filter(Boolean),i={...n.section,steps:L};s("update:section",i)};return(q,M)=>(p(),E("div",Wt,[g(zt,{open:t.value,"onUpdate:open":M[0]||(M[0]=L=>t.value=L),"caret-position":"left","header-hover":!0,"header-group":""},{header:O(()=>[o("div",Yt,[o("div",Xt,[h.readonly?R("",!0):(p(),E("button",{key:0,type:"button",class:"drag-handle shrink-0 opacity-0 group-hover:opacity-100 transition-opacity text-gray-400 hover:text-gray-600 cursor-move",title:e(l)("common.drag")},[g(e(de),{size:16})],8,Jt)),o("span",Zt,k(h.section.name),1),o("span",eo,k(h.section.steps.length),1)]),h.readonly?R("",!0):(p(),E("div",to,[o("button",{type:"button",class:"rounded p-1 hover:bg-gray-100","aria-label":e(l)("common.edit"),onClick:oe(r,["stop"])},[g(e(we),{size:14,class:"text-gray-500","aria-hidden":"true"})],8,oo),o("button",{type:"button",class:"rounded p-1 hover:bg-gray-100","aria-label":e(l)("common.delete"),onClick:oe(c,["stop"])},[g(e(re),{size:14,class:"text-gray-500","aria-hidden":"true"})],8,no)]))])]),default:O(()=>[o("div",lo,[g(Kt,{steps:h.section.steps,"section-id":h.section.id,readonly:h.readonly,onAddSlide:a,onAddQuestion:f,onEditSlide:_,onEditQuestion:S,onDeleteStep:V,onReorderSteps:w},null,8,["steps","section-id","readonly"])])]),_:1},8,["open"])]))}}),ao={class:"space-y-2"},io={key:0,class:"text-center py-8 text-gray-500 text-sm"},ro=P({__name:"CourseStructureView",props:{structure:{},readonly:{type:Boolean}},emits:["update:structure","add-section","edit-section-name","delete-section","add-slide","add-question","edit-slide","edit-question","delete-step"],setup(h,{emit:x}){const{t:l}=H(),n=h,s=x,t=I([]);j(()=>n.structure,i=>{t.value=[...i]},{immediate:!0});const r=()=>{s("update:structure",[...t.value]),t.value=[...n.structure]},c=()=>{s("add-section")},a=i=>{s("edit-section-name",{sectionId:i.id})},f=i=>{s("delete-section",{sectionId:i.id})},_=i=>{s("add-slide",{sectionId:i.id})},S=i=>{s("add-question",{sectionId:i.id})},V=(i,d)=>{s("edit-slide",{sectionId:i.id,stepId:d.stepId})},w=(i,d)=>{s("edit-question",{sectionId:i.id,stepId:d.stepId})},q=(i,d)=>{s("delete-step",{sectionId:i.id,stepId:d.stepId})},M=(i,d)=>{const u=new Map(i.steps.map(N=>[N.id,N])),y=d.newOrder.map(N=>u.get(N)).filter(Boolean),C={...i,steps:y},F=t.value.map(N=>N.id===i.id?C:N);t.value=F,s("update:structure",F)},L=i=>{const d=t.value.map(u=>u.id===i.id?i:u);t.value=d,s("update:structure",d)};return(i,d)=>(p(),E("div",ao,[t.value.length===0?(p(),E("div",io,k(e(l)("courseStructureView.noSections")),1)):(p(),U(e(ce),{key:1,modelValue:t.value,"onUpdate:modelValue":d[0]||(d[0]=u=>t.value=u),"item-key":"id",tag:"div",class:"space-y-2",animation:200,disabled:h.readonly,handle:".drag-handle",onChange:r},{default:O(()=>[(p(!0),E(le,null,se(t.value,(u,y)=>(p(),U(so,{key:u.id,section:u,"section-index":y,readonly:h.readonly,onEditName:C=>a(u),onDelete:C=>f(u),onAddSlide:C=>_(u),onAddQuestion:C=>S(u),onEditSlide:C=>V(u,C),onEditQuestion:C=>w(u,C),onDeleteStep:C=>q(u,C),onReorderSteps:C=>M(u,C),"onUpdate:section":L},null,8,["section","section-index","readonly","onEditName","onDelete","onAddSlide","onAddQuestion","onEditSlide","onEditQuestion","onDeleteStep","onReorderSteps"]))),128))]),_:1},8,["modelValue","disabled"])),h.readonly?R("",!0):(p(),E("button",{key:2,type:"button",class:"w-full px-3 py-2 text-sm text-gray-600 border border-gray-300 border-dashed rounded-md hover:bg-gray-50 hover:border-gray-400 transition-colors inline-flex items-center justify-center gap-2",onClick:c},[g(e(pt),{size:16,class:"text-gray-500"}),o("span",null,k(e(l)("courseStructureView.addSection")),1)]))]))}}),uo=ue(ro,[["__scopeId","data-v-08de7304"]]),co={class:"fixed inset-0 flex items-center justify-center p-4"},po={class:"flex items-center justify-between p-6 border-b"},vo={class:"p-6"},mo={class:"block text-sm font-medium text-gray-700 mb-1"},yo=["placeholder"],bo={key:0,class:"mt-1 text-xs text-red-500"},fo={class:"flex items-center justify-end gap-3 p-6 border-t bg-gray-50"},go=["disabled"],ho=P({__name:"SectionEditorModal",props:{section:{},open:{type:Boolean}},emits:["update:open","save"],setup(h,{emit:x}){const{t:l}=H(),n=h,s=x,t=I(""),r=I(null),c=A(()=>n.section===null),a=A(()=>t.value.trim().length>0);j(()=>n.open,V=>{V&&(t.value=n.section?.name||"",r.value=null)});const f=()=>{t.value.trim()?r.value=null:r.value=l("sectionEditorModal.validation.nameRequired")},_=()=>{s("update:open",!1)},S=()=>{if(!a.value){f();return}const V=n.section?{...n.section,name:t.value.trim()}:{id:`section-${Math.random().toString(36).substr(2,9)}`,name:t.value.trim(),steps:[]};s("save",V),s("update:open",!1)};return(V,w)=>(p(),U(e(Ee),{show:h.open,as:"template"},{default:O(()=>[g(e(Ve),{open:h.open,onClose:_,class:"relative z-50"},{default:O(()=>[g(e(ne),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:O(()=>[...w[1]||(w[1]=[o("div",{class:"fixed inset-0 bg-black/30"},null,-1)])]),_:1}),o("div",co,[g(e(ne),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:O(()=>[g(e(Se),{class:"w-full max-w-md bg-white rounded-lg shadow-xl"},{default:O(()=>[o("div",po,[g(e(Ce),{class:"text-lg font-semibold"},{default:O(()=>[G(k(c.value?e(l)("sectionEditorModal.createTitle"):e(l)("sectionEditorModal.editTitle")),1)]),_:1}),o("button",{type:"button",class:"rounded p-1 hover:bg-gray-100",onClick:_},[g(e(Ie),{size:20,class:"text-gray-500"})])]),o("div",vo,[o("div",null,[o("label",mo,[G(k(e(l)("sectionEditorModal.nameLabel"))+" ",1),w[2]||(w[2]=o("span",{class:"text-red-500"},"*",-1))]),Z(o("input",{"onUpdate:modelValue":w[0]||(w[0]=q=>t.value=q),type:"text",class:T(["w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2",r.value?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-blue-500"]),placeholder:e(l)("sectionEditorModal.namePlaceholder"),onInput:f},null,42,yo),[[ee,t.value]]),r.value?(p(),E("p",bo,k(r.value),1)):R("",!0)])]),o("div",fo,[o("button",{type:"button",class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",onClick:_},k(e(l)("common.cancel")),1),o("button",{type:"button",class:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!a.value,onClick:S},k(e(l)("common.save")),9,go)])]),_:1})]),_:1})])]),_:1},8,["open"])]),_:1},8,["show"]))}}),xo={class:"flex flex-col h-full space-y-4 min-h-0"},_o={class:"flex-shrink-0"},ko={class:"block text-sm font-medium text-gray-700 mb-1"},$o=["value","readonly","disabled","placeholder"],wo={key:0,class:"mt-1 text-xs text-red-500"},Eo={class:"flex flex-col flex-1 min-h-0"},So={class:"block text-sm font-medium text-gray-700 mb-1 flex-shrink-0"},Co={key:0,class:"mt-1 text-xs text-red-500 flex-shrink-0"},Io=P({__name:"SlideEditor",props:{modelValue:{},readonly:{type:Boolean}},emits:["update:modelValue","update:valid"],setup(h,{emit:x}){const{t:l}=H(),n=h,s=x,t=A({get(){return n.modelValue},set(_){s("update:modelValue",_)}}),r=A(()=>{const _={};return t.value.name.trim()||(_.name=l("slideEditor.validation.nameRequired")),t.value.content.replace(/<[^>]*>/g,"").trim()||(_.content=l("slideEditor.validation.contentRequired")),_}),c=A(()=>Object.keys(r.value).length===0);j(()=>c.value,_=>{s("update:valid",_)},{immediate:!0});const a=_=>{t.value={...t.value,name:_}},f=_=>{t.value={...t.value,content:_}};return(_,S)=>(p(),E("div",xo,[o("div",_o,[o("label",ko,[G(k(e(l)("slideEditor.name"))+" ",1),S[1]||(S[1]=o("span",{class:"text-red-500"},"*",-1))]),(p(),E("input",{key:`slide-name-${n.modelValue.id}`,value:t.value.name,type:"text",readonly:n.readonly,disabled:n.readonly,class:T(["w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2",r.value.name?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-blue-500",n.readonly?"bg-gray-50 cursor-not-allowed":""]),placeholder:e(l)("slideEditor.namePlaceholder"),onInput:S[0]||(S[0]=V=>a(V.target.value))},null,42,$o)),r.value.name?(p(),E("p",wo,k(r.value.name),1)):R("",!0)]),o("div",Eo,[o("label",So,[G(k(e(l)("slideEditor.content"))+" ",1),S[2]||(S[2]=o("span",{class:"text-red-500"},"*",-1))]),o("div",{class:T(["border rounded-md flex flex-col flex-1 min-h-0",r.value.content?"border-red-500":"border-gray-300"])},[g(pe,{"model-value":t.value.content,placeholder:e(l)("slideEditor.contentPlaceholder"),readonly:n.readonly,"onUpdate:modelValue":f},null,8,["model-value","placeholder","readonly"])],2),r.value.content?(p(),E("p",Co,k(r.value.content),1)):R("",!0)])]))}}),Vo={class:"flex flex-col h-full space-y-4 min-h-0"},To={class:"shrink-0"},qo={class:"block text-sm font-medium text-gray-700 mb-1"},Oo=["value","readonly","disabled","placeholder"],Ro={key:0,class:"mt-1 text-xs text-red-500"},Ao={class:"flex flex-col flex-1 min-h-0"},zo={class:"block text-sm font-medium text-gray-700 mb-1 shrink-0"},Bo={class:"flex flex-col flex-1 min-h-0 border rounded-md border-gray-300"},Mo={class:"shrink-0"},No={class:"block text-sm font-medium text-gray-700 mb-2"},Uo={class:"flex gap-4"},Lo=["checked","disabled"],Qo={class:"text-sm text-gray-700"},Po=["checked","disabled"],jo={class:"text-sm text-gray-700"},Do={class:"shrink-0"},Ho={class:"block text-sm font-medium text-gray-700 mb-2"},Fo=["title"],Go={class:"shrink-0 flex items-center"},Ko=["checked","disabled","name","onChange"],Wo=["checked","disabled","onChange"],Yo={class:"flex-1 flex items-center"},Xo=["onUpdate:modelValue","readonly","disabled","placeholder","onInput"],Jo={key:1,class:"absolute -bottom-5 left-0 right-0"},Zo={class:"text-xs text-red-500"},en=["disabled","title","onClick"],tn={key:1,class:"text-xs text-red-500"},on=P({__name:"QuestionEditor",props:{modelValue:{},readonly:{type:Boolean}},emits:["update:modelValue","update:valid"],setup(h,{emit:x}){const{t:l}=H(),n=h,s=x,t=A({get(){return n.modelValue},set(i){s("update:modelValue",i)}}),r=I([]);j(()=>n.modelValue.options,i=>{r.value=i.map((d,u)=>({id:u,text:d}))},{immediate:!0});const c=A(()=>{const i={};t.value.name.trim()||(i.name=l("questionEditor.validation.nameRequired")),t.value.options.length<2&&(i.options=l("questionEditor.validation.minOptionsRequired"));const d={};return t.value.options.forEach((u,y)=>{u.trim()||(d[y]=l("questionEditor.validation.optionRequired"))}),Object.keys(d).length>0&&(i.optionTexts=d),i}),a=A(()=>Object.keys(c.value).length===0);j(()=>a.value,i=>{s("update:valid",i)},{immediate:!0});const f=i=>{if(!i.moved){r.value=n.modelValue.options.map((z,Q)=>({id:Q,text:z}));return}const{oldIndex:d,newIndex:u}=i.moved,y=[...n.modelValue.options],C=y[d];if(C===void 0)return;y.splice(d,1),y.splice(u,0,C);const F=new Map;n.modelValue.options.forEach((z,Q)=>{const te=y.indexOf(z);te!==-1&&F.set(Q,te)});const N=n.modelValue.inputRule.correctOptions.map(z=>F.get(z)).filter(z=>typeof z=="number").sort((z,Q)=>z-Q);t.value={...t.value,options:y,inputRule:{...t.value.inputRule,correctOptions:N}},r.value=y.map((z,Q)=>({id:Q,text:z}))},_=i=>{t.value={...t.value,name:i}},S=i=>{t.value={...t.value,slide:i}},V=i=>{const d=t.value.inputRule.correctOptions;let u=d;if(i==="single"){const y=d[0];u=y!==void 0?[y]:[]}t.value={...t.value,inputRule:{type:i,correctOptions:u}}},w=()=>{const i=[...t.value.options,""];t.value={...t.value,options:i},r.value=i.map((d,u)=>({id:u,text:d}))},q=i=>{const d=r.value[i];if(!d)return;const u=d.text,y=[...t.value.options];y[i]=u,t.value={...t.value,options:y}},M=i=>{if(t.value.options.length<=2)return;const d=t.value.options.filter((y,C)=>C!==i),u=t.value.inputRule.correctOptions.filter(y=>y!==i).map(y=>y>i?y-1:y).sort((y,C)=>y-C);t.value={...t.value,options:d,inputRule:{...t.value.inputRule,correctOptions:u}},r.value=d.map((y,C)=>({id:C,text:y}))},L=i=>{const d=t.value.inputRule.correctOptions,u=d.includes(i);let y;t.value.inputRule.type==="single"?y=u?[]:[i]:u?y=d.filter(C=>C!==i):y=[...d,i].sort((C,F)=>C-F),t.value={...t.value,inputRule:{...t.value.inputRule,correctOptions:y}}};return(i,d)=>(p(),E("div",Vo,[o("div",To,[o("label",qo,[G(k(e(l)("questionEditor.name"))+" ",1),d[4]||(d[4]=o("span",{class:"text-red-500"},"*",-1))]),(p(),E("input",{key:`question-name-${n.modelValue.id}`,value:t.value.name,type:"text",readonly:n.readonly,disabled:n.readonly,class:T(["w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2",c.value.name?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-blue-500",n.readonly?"bg-gray-50 cursor-not-allowed":""]),placeholder:e(l)("questionEditor.namePlaceholder"),onInput:d[0]||(d[0]=u=>_(u.target.value))},null,42,Oo)),c.value.name?(p(),E("p",Ro,k(c.value.name),1)):R("",!0)]),o("div",Ao,[o("label",zo,k(e(l)("questionEditor.questionText")),1),o("div",Bo,[g(pe,{"model-value":t.value.slide,placeholder:e(l)("questionEditor.questionTextPlaceholder"),readonly:n.readonly,"onUpdate:modelValue":S},null,8,["model-value","placeholder","readonly"])])]),o("div",Mo,[o("label",No,k(e(l)("questionEditor.inputRule")),1),o("div",Uo,[o("label",{class:T(["flex items-center gap-2",n.readonly?"":"cursor-pointer"])},[o("input",{type:"radio",checked:t.value.inputRule.type==="single",disabled:n.readonly,class:"w-4 h-4 text-blue-600 focus:ring-blue-500 disabled:cursor-not-allowed",onChange:d[1]||(d[1]=u=>V("single"))},null,40,Lo),o("span",Qo,k(e(l)("questionEditor.singleChoice")),1)],2),o("label",{class:T(["flex items-center gap-2",n.readonly?"":"cursor-pointer"])},[o("input",{type:"radio",checked:t.value.inputRule.type==="multiple",disabled:n.readonly,class:"w-4 h-4 text-blue-600 focus:ring-blue-500 disabled:cursor-not-allowed",onChange:d[2]||(d[2]=u=>V("multiple"))},null,40,Po),o("span",jo,k(e(l)("questionEditor.multipleChoice")),1)],2)])]),o("div",Do,[o("label",Ho,[G(k(e(l)("questionEditor.options"))+" ",1),d[5]||(d[5]=o("span",{class:"text-red-500"},"*",-1))]),o("div",{class:T(["border rounded-md p-3 space-y-2",c.value.options?"border-red-500":"border-gray-300"])},[g(e(ce),{modelValue:r.value,"onUpdate:modelValue":d[3]||(d[3]=u=>r.value=u),"item-key":"id",tag:"div",class:"space-y-2",animation:200,disabled:n.readonly,handle:n.readonly?"":".drag-handle",onChange:f},{default:O(()=>[(p(!0),E(le,null,se(r.value,(u,y)=>(p(),E("div",{key:u.id,class:"relative flex items-center gap-2 px-2 py-1 border border-gray-200 rounded-md hover:bg-gray-50"},[n.readonly?R("",!0):(p(),E("button",{key:0,type:"button",class:"drag-handle text-gray-400 cursor-move hover:text-gray-600 shrink-0 flex items-center",title:e(l)("common.drag")},[g(e(de),{size:18})],8,Fo)),o("div",Go,[t.value.inputRule.type==="single"?(p(),E("input",{key:0,type:"radio",checked:t.value.inputRule.correctOptions.includes(y),disabled:n.readonly||!u.text.trim(),class:"w-4 h-4 text-blue-600 focus:ring-blue-500 disabled:cursor-not-allowed",name:`correct-${t.value.id}`,onChange:C=>L(y)},null,40,Ko)):(p(),E("input",{key:1,type:"checkbox",checked:t.value.inputRule.correctOptions.includes(y),disabled:n.readonly||!u.text.trim(),class:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500 disabled:cursor-not-allowed",onChange:C=>L(y)},null,40,Wo))]),o("div",Yo,[Z(o("input",{"onUpdate:modelValue":C=>u.text=C,type:"text",readonly:n.readonly,disabled:n.readonly,class:T(["w-full px-2 py-1 text-sm border rounded focus:outline-none focus:ring-1",c.value.optionTexts?.[y]?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-blue-500",n.readonly?"bg-gray-50 cursor-not-allowed":""]),placeholder:e(l)("questionEditor.optionPlaceholder"),onInput:C=>q(y)},null,42,Xo),[[ee,u.text]])]),c.value.optionTexts?.[y]?(p(),E("div",Jo,[o("p",Zo,k(c.value.optionTexts[y]),1)])):R("",!0),o("button",{type:"button",disabled:n.readonly||t.value.options.length<=2,class:T(["shrink-0 p-1 text-gray-400 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",n.readonly?"":"hover:text-red-600"]),title:n.readonly?"":e(l)("common.delete"),onClick:C=>M(y)},[g(e(re),{size:16})],10,en)]))),128))]),_:1},8,["modelValue","disabled","handle"]),n.readonly?R("",!0):(p(),E("button",{key:0,type:"button",class:"w-full px-3 py-2 text-sm text-gray-600 border border-gray-300 border-dashed rounded-md hover:bg-gray-50 hover:border-gray-400 transition-colors",onClick:w}," + "+k(e(l)("questionEditor.addOption")),1)),c.value.options?(p(),E("p",tn,k(c.value.options),1)):R("",!0)],2)])]))}}),nn={class:"fixed inset-0 flex items-center justify-center p-4"},ln={class:"flex items-center justify-between p-6 border-b"},sn={class:"p-6 overflow-y-auto flex-1"},an={class:"flex items-center justify-end gap-3 p-6 border-t bg-gray-50"},dn=["disabled"],rn=["disabled"],un=P({__name:"StepEditorModal",props:{step:{},open:{type:Boolean},stepType:{}},emits:["update:open","save"],setup(h,{emit:x}){const{t:l}=H(),n=h,s=x,t=I(null),r=I(null),c=I(!1),a=I(!1),f=A(()=>n.step===null),_=A(()=>n.step?.type==="slide"||!n.step&&n.stepType==="slide"),S=A(()=>n.step?.type==="question"||!n.step&&n.stepType==="question"),V=A(()=>t.value?`slide-${t.value.id}-${n.open}`:"new-slide"),w=A(()=>r.value?`question-${r.value.id}-${n.open}`:"new-question");j(()=>n.open,u=>{u&&(n.step?(n.step.type==="slide"?(t.value={id:n.step.id,type:n.step.type,name:n.step.name,content:n.step.content},r.value=null):(r.value={id:n.step.id,type:n.step.type,name:n.step.name,slide:n.step.slide,options:[...n.step.options],inputRule:{type:n.step.inputRule.type,correctOptions:[...n.step.inputRule.correctOptions]}},t.value=null),c.value=!0,a.value=!0):(n.stepType==="slide"?(t.value={id:`slide-${Math.random().toString(36).substr(2,9)}`,type:"slide",name:"",content:""},r.value=null):(r.value={id:`question-${Math.random().toString(36).substr(2,9)}`,type:"question",name:"",slide:"",options:["",""],inputRule:{type:"single",correctOptions:[]}},t.value=null,a.value=!1),c.value=!1))});const q=u=>{t.value=u},M=u=>{r.value=u},L=()=>{s("update:open",!1)},i=()=>{!t.value||!c.value||(s("save",t.value),s("update:open",!1))},d=()=>{!r.value||!a.value||(s("save",r.value),s("update:open",!1))};return(u,y)=>(p(),U(e(Ee),{show:h.open,as:"template"},{default:O(()=>[g(e(Ve),{open:h.open,onClose:L,class:"relative z-60"},{default:O(()=>[g(e(ne),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:O(()=>[...y[2]||(y[2]=[o("div",{class:"fixed inset-0 bg-black/30"},null,-1)])]),_:1}),o("div",nn,[g(e(ne),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:O(()=>[g(e(Se),{class:"w-full max-w-3xl h-full max-h-[90vh] bg-white rounded-lg shadow-xl flex flex-col"},{default:O(()=>[o("div",ln,[g(e(Ce),{class:"text-lg font-semibold"},{default:O(()=>[G(k(f.value?e(l)("stepEditorModal.createTitle"):e(l)("stepEditorModal.editTitle"))+" "+k(h.stepType==="slide"?e(l)("stepEditorModal.slide"):e(l)("stepEditorModal.question")),1)]),_:1}),o("button",{type:"button",class:"rounded p-1 hover:bg-gray-100",onClick:L},[g(e(Ie),{size:20,class:"text-gray-500"})])]),o("div",sn,[_.value&&t.value?(p(),U(Io,{key:V.value,"model-value":t.value,"onUpdate:modelValue":q,"onUpdate:valid":y[0]||(y[0]=C=>c.value=C)},null,8,["model-value"])):R("",!0),S.value&&r.value?(p(),U(on,{key:w.value,"model-value":r.value,"onUpdate:modelValue":M,"onUpdate:valid":y[1]||(y[1]=C=>a.value=C)},null,8,["model-value"])):R("",!0)]),o("div",an,[o("button",{type:"button",class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",onClick:L},k(e(l)("common.cancel")),1),_.value?(p(),E("button",{key:0,type:"button",class:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!c.value,onClick:i},k(e(l)("common.save")),9,dn)):R("",!0),S.value?(p(),E("button",{key:1,type:"button",class:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!a.value,onClick:d},k(e(l)("common.save")),9,rn)):R("",!0)])]),_:1})]),_:1})])]),_:1},8,["open"])]),_:1},8,["show"]))}}),cn={class:"mx-auto max-w-2xl"},pn={class:"rounded-lg border border-gray-200 bg-white shadow-sm"},vn={class:"p-4 border-b border-gray-100"},mn={class:"text-lg font-semibold"},yn={class:"block text-sm font-medium text-gray-700 mb-1"},bn=["placeholder"],fn={class:"grid grid-cols-1 gap-4"},gn={class:"block text-sm font-medium text-gray-700 mb-1"},hn=["placeholder"],xn={class:"block text-sm font-medium text-gray-700 mb-1"},_n=["placeholder"],kn={class:"block text-sm font-medium text-gray-700 mb-1"},$n={key:0,class:"mt-1 text-xs text-red-500"},wn={class:"block text-sm font-medium text-gray-700 mb-1"},En={class:"p-4 border-t border-gray-200 flex gap-2 justify-end"},Sn=["disabled"],An=P({__name:"CourseEditorPage",setup(h){const{t:x}=H(),l=I(0),n=A(()=>[{label:x("courseEditor.tabGeneral")},{label:x("courseEditor.tabDescription")},{label:x("courseEditor.tabStructure")}]),s=je(),t=Pe(),r=Ke,c=I(null),a=I(""),f=I(null),_=I(""),S=I(""),V=I(""),w=I([]),q=I([]),M=A(()=>d.value?.objectId&&typeof d.value.objectId=="string"?d.value.objectId:null),L=async()=>{q.value=await He(r)},i=A(()=>t.path==="/course/new"),d=A(()=>c.value!=null?q.value.find(v=>v.id===c.value&&v.deletedAt===null)??null:null),u=A(()=>!!(a.value.trim()&&f.value!=null)),y=v=>{const m=v.split("/").filter(Boolean).map($=>Number($)).filter($=>Number.isFinite($)),b=m.length>0?m[m.length-1]:void 0;return b??null};_e(async()=>{if(await L(),i.value){const v=t.query.parentId;if(v){const m=Number(v);Number.isFinite(m)&&(f.value=m)}c.value=null}else{const m=(t.params.path||"").replace(/\/edit$/,""),b=m.endsWith("/")?m:`${m}/`;if(c.value=y(b),d.value&&d.value.type==="leaf"){a.value=d.value.name,f.value=d.value.parentId??null;const $=d.value.objectId;if(typeof $=="string"&&$){const B=De($);B&&B.deletedAt===null&&(_.value=B.author,S.value=B.fullName,V.value=B.description,w.value=B.structure||[])}else S.value=a.value,w.value=[]}else s.push({path:"/"})}});const C=async()=>{if(!(!a.value.trim()||f.value==null))if(i.value){const v=await me({author:_.value,fullName:S.value||a.value.trim(),description:V.value,structure:[]});await Fe(r,f.value,{name:a.value.trim(),type:"leaf"}),await L();const m=q.value.filter($=>$.deletedAt===null).filter($=>$.parentId===f.value).filter($=>$.name===a.value.trim()).filter($=>$.type==="leaf").sort(($,B)=>B.id-$.id)[0];m&&await ye(r,m.id,v.id);const b=f.value?q.value.find($=>$.id===f.value)?.path??"/":"/";s.push({path:b})}else{if(!c.value)return;const v=d.value?.objectId;if(typeof v=="string"&&v)await be(v,{author:_.value,fullName:S.value,description:V.value,structure:w.value});else{const b=await me({author:_.value,fullName:S.value||a.value.trim(),description:V.value,structure:[]});await ye(r,c.value,b.id)}await Ge(r,c.value,a.value.trim(),f.value);const m=f.value?q.value.find(b=>b.id===f.value)?.path??"/":"/";s.push({path:m})}},F=()=>{if(i.value){const v=f.value?q.value.find(m=>m.id===f.value)?.path??"/":"/";s.push({path:v})}else{const v=d.value;if(v){const m=v.parentId?q.value.find(b=>b.id===v.parentId&&b.deletedAt===null)?.path??"/":"/";s.push({path:m})}else s.push({path:"/"})}},N=async v=>{w.value=v,M.value&&await be(M.value,{structure:v})},z=I(!1),Q=I(null),te=()=>{Q.value=null,z.value=!0},Te=v=>{const m=w.value.find(b=>b.id===v.sectionId);m&&(Q.value={...m},z.value=!0)},qe=v=>{const m=w.value.find(B=>B.id===v.sectionId);if(!m||!window.confirm(`${x("common.delete")} "${m.name}"?`))return;const $=w.value.filter(B=>B.id!==v.sectionId);N($)},Oe=v=>{if(Q.value===null)N([...w.value,v]);else{const m=w.value.map(b=>b.id===v.id?v:b);N(m)}z.value=!1,Q.value=null},W=I(!1),Y=I(null),X=I("slide"),K=I(null),Re=v=>{K.value=v.sectionId,X.value="slide",Y.value=null,W.value=!0},Ae=v=>{K.value=v.sectionId,X.value="question",Y.value=null,W.value=!0},ze=v=>{const m=w.value.find($=>$.id===v.sectionId);if(!m)return;const b=m.steps.find($=>$.id===v.stepId);!b||b.type!=="slide"||(K.value=v.sectionId,X.value="slide",Y.value={...b},W.value=!0)},Be=v=>{const m=w.value.find($=>$.id===v.sectionId);if(!m)return;const b=m.steps.find($=>$.id===v.stepId);!b||b.type!=="question"||(K.value=v.sectionId,X.value="question",Y.value={...b,options:[...b.options],inputRule:{...b.inputRule,correctOptions:[...b.inputRule.correctOptions]}},W.value=!0)},Me=v=>{const m=w.value.find(D=>D.id===v.sectionId);if(!m)return;const b=m.steps.find(D=>D.id===v.stepId);if(!b||!window.confirm(`${x("common.delete")} "${b.name||x("stepList.unnamedStep")}"?`))return;const B=w.value.map(D=>D.id===v.sectionId?{...D,steps:D.steps.filter(J=>J.id!==v.stepId)}:D);N(B)},Ne=v=>{if(!K.value||!w.value.find($=>$.id===K.value))return;const b=w.value.map($=>{if($.id===K.value){const B=$.steps.findIndex(J=>J.id===v.id),D=B>=0?$.steps.map((J,Ue)=>Ue===B?v:J):[...$.steps,v];return{...$,steps:D}}return $});N(b),W.value=!1,Y.value=null,K.value=null};return(v,m)=>(p(),E("div",cn,[o("div",pn,[o("div",vn,[o("h1",mn,k(i.value?e(x)("courseEditor.newTitle"):e(x)("courseEditor.title")),1)]),g(e(vt),{"selected-index":l.value,onChange:m[5]||(m[5]=b=>l.value=b)},{default:O(()=>[g(e(mt),{class:"flex border-b border-gray-200"},{default:O(()=>[(p(!0),E(le,null,se(n.value,(b,$)=>(p(),U(e(yt),{key:$,as:"button",type:"button",class:T(["px-4 py-2 text-sm font-medium focus:outline-none transition-colors",l.value===$?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700"])},{default:O(()=>[G(k(b.label),1)]),_:2},1032,["class"]))),128))]),_:1}),g(e(bt),{class:"p-4"},{default:O(()=>[g(e(ae),{class:"space-y-4"},{default:O(()=>[o("div",null,[o("label",yn,k(e(x)("courseEditor.nameLabel")),1),Z(o("input",{"onUpdate:modelValue":m[0]||(m[0]=b=>a.value=b),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:e(x)("courseEditor.namePlaceholder")},null,8,bn),[[ee,a.value]])]),o("div",fn,[o("div",null,[o("label",gn,k(e(x)("courseEditor.fullName")),1),Z(o("input",{"onUpdate:modelValue":m[1]||(m[1]=b=>S.value=b),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:e(x)("courseEditor.fullNamePlaceholder")},null,8,hn),[[ee,S.value]])]),o("div",null,[o("label",xn,k(e(x)("courseEditor.author")),1),Z(o("input",{"onUpdate:modelValue":m[2]||(m[2]=b=>_.value=b),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:e(x)("courseEditor.authorPlaceholder")},null,8,_n),[[ee,_.value]])])]),o("div",null,[o("label",kn,k(e(x)("common.folder")),1),g(We,{"forest-id":e(r),"current-folder-id":c.value,value:f.value,"allow-root":!1,"onUpdate:value":m[3]||(m[3]=b=>f.value=b)},null,8,["forest-id","current-folder-id","value"]),f.value?R("",!0):(p(),E("p",$n,k(e(x)("courseEditor.folderRequired")),1))])]),_:1}),g(e(ae),null,{default:O(()=>[o("div",null,[o("label",wn,k(e(x)("courseEditor.description")),1),g(pe,{class:"min-h-[180px]",key:"description-editor",modelValue:V.value,"onUpdate:modelValue":m[4]||(m[4]=b=>V.value=b),placeholder:e(x)("courseEditor.descriptionPlaceholder")},null,8,["modelValue","placeholder"])])]),_:1}),!i.value&&M.value?(p(),U(e(ae),{key:0},{default:O(()=>[g(uo,{structure:w.value,class:"min-h-full","onUpdate:structure":N,onAddSection:te,onEditSectionName:Te,onDeleteSection:qe,onAddSlide:Re,onAddQuestion:Ae,onEditSlide:ze,onEditQuestion:Be,onDeleteStep:Me},null,8,["structure"])]),_:1})):R("",!0)]),_:1})]),_:1},8,["selected-index"]),o("div",En,[o("button",{type:"button",class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",onClick:F},k(e(x)("common.cancel")),1),o("button",{type:"button",class:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!u.value,onClick:C},k(i.value?e(x)("common.create"):e(x)("common.save")),9,Sn)])]),g(ho,{section:Q.value,open:z.value,"onUpdate:open":m[6]||(m[6]=b=>z.value=b),onSave:Oe},null,8,["section","open"]),g(un,{step:Y.value,open:W.value,"step-type":X.value,"onUpdate:open":m[7]||(m[7]=b=>W.value=b),onSave:Ne},null,8,["step","open","step-type"])]))}});export{An as default};
